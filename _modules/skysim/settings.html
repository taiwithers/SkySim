
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>skysim.settings &#8212; SkySim 0.1.0</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../../_static/autodoc_pydantic.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css?v=f1aa5710" />
  
  <!-- So that users can add custom icons -->
  <script src="../../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../../_static/documentation_options.js?v=a1637f0b"></script>
    <script src="../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '_modules/skysim/settings';</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="0.1.0" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
  
  
    <p class="title logo__title">SkySim 0.1.0</p>
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../usage.html">
    Installation & Usage
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../examples/index.html">
    Examples
  </a>
</li>

            <li class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button"
                data-bs-toggle="dropdown" aria-expanded="false"
                aria-controls="pst-nav-more-links">
                    More
                </button>
                <ul id="pst-nav-more-links" class="dropdown-menu">
                    
<li class=" ">
  <a class="nav-link dropdown-item nav-internal" href="../../api/index.html">
    API Documentation
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-internal" href="../../devnotes.html">
    Developer Documentation
  </a>
</li>

                </ul>
            </li>
            
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/taiwithers/SkySim" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar hide-on-wide">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../usage.html">
    Installation & Usage
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../examples/index.html">
    Examples
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../api/index.html">
    API Documentation
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../devnotes.html">
    Developer Documentation
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/taiwithers/SkySim" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../index.html" class="nav-link">Module code</a></li>
    
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">skysim.settings</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <h1>Source code for skysim.settings</h1><div class="highlight"><pre>
<span></span><span class="linenos">   1</span><span class="sd">&quot;&quot;&quot;Setup functionality for SkySim. Includes both methods for parsing a</span>
<span class="linenos">   2</span><span class="sd">configuration TOML, and converting that data in `Settings` (and friends)</span>
<span class="linenos">   3</span><span class="sd">objects.</span>
<span class="linenos">   4</span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos">   5</span>
<span class="linenos">   6</span><span class="c1"># License: GPLv3+ (see COPYING); Copyright (C) 2025 Tai Withers</span>
<span class="linenos">   7</span>
<span class="linenos">   8</span><span class="kn">import</span><span class="w"> </span><span class="nn">tomllib</span>
<span class="linenos">   9</span><span class="kn">from</span><span class="w"> </span><span class="nn">collections.abc</span><span class="w"> </span><span class="kn">import</span> <span class="n">Mapping</span>
<span class="linenos">  10</span><span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">date</span><span class="p">,</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">timedelta</span>
<span class="linenos">  11</span><span class="kn">from</span><span class="w"> </span><span class="nn">functools</span><span class="w"> </span><span class="kn">import</span> <span class="n">cached_property</span>
<span class="linenos">  12</span><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="linenos">  13</span><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">ForwardRef</span><span class="p">,</span> <span class="n">Self</span>  <span class="c1"># pylint: disable=unused-import</span>
<span class="linenos">  14</span><span class="kn">from</span><span class="w"> </span><span class="nn">zoneinfo</span><span class="w"> </span><span class="kn">import</span> <span class="n">ZoneInfo</span>
<span class="linenos">  15</span>
<span class="linenos">  16</span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="linenos">  17</span><span class="kn">from</span><span class="w"> </span><span class="nn">astropy</span><span class="w"> </span><span class="kn">import</span> <span class="n">units</span> <span class="k">as</span> <span class="n">u</span>
<span class="linenos">  18</span><span class="kn">from</span><span class="w"> </span><span class="nn">astropy.coordinates</span><span class="w"> </span><span class="kn">import</span> <span class="n">ICRS</span><span class="p">,</span> <span class="n">AltAz</span><span class="p">,</span> <span class="n">Angle</span><span class="p">,</span> <span class="n">EarthLocation</span><span class="p">,</span> <span class="n">SkyCoord</span>
<span class="linenos">  19</span><span class="kn">from</span><span class="w"> </span><span class="nn">astropy.coordinates.name_resolve</span><span class="w"> </span><span class="kn">import</span> <span class="n">NameResolveError</span>
<span class="linenos">  20</span><span class="kn">from</span><span class="w"> </span><span class="nn">astropy.time</span><span class="w"> </span><span class="kn">import</span> <span class="n">Time</span>
<span class="linenos">  21</span><span class="kn">from</span><span class="w"> </span><span class="nn">astropy.wcs</span><span class="w"> </span><span class="kn">import</span> <span class="n">WCS</span>
<span class="linenos">  22</span><span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib.colors</span><span class="w"> </span><span class="kn">import</span> <span class="n">LinearSegmentedColormap</span>
<span class="linenos">  23</span><span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
<span class="linenos">  24</span>    <span class="n">BaseModel</span><span class="p">,</span>
<span class="linenos">  25</span>    <span class="n">ConfigDict</span><span class="p">,</span>
<span class="linenos">  26</span>    <span class="n">Field</span><span class="p">,</span>
<span class="linenos">  27</span>    <span class="n">NonNegativeFloat</span><span class="p">,</span>
<span class="linenos">  28</span>    <span class="n">PositiveFloat</span><span class="p">,</span>
<span class="linenos">  29</span>    <span class="n">PositiveInt</span><span class="p">,</span>
<span class="linenos">  30</span>    <span class="n">ValidationError</span><span class="p">,</span>
<span class="linenos">  31</span>    <span class="n">ValidationInfo</span><span class="p">,</span>
<span class="linenos">  32</span>    <span class="n">computed_field</span><span class="p">,</span>
<span class="linenos">  33</span>    <span class="n">field_validator</span><span class="p">,</span>
<span class="linenos">  34</span>    <span class="n">model_validator</span><span class="p">,</span>
<span class="linenos">  35</span><span class="p">)</span>
<span class="linenos">  36</span><span class="kn">from</span><span class="w"> </span><span class="nn">timezonefinder</span><span class="w"> </span><span class="kn">import</span> <span class="n">TimezoneFinder</span>
<span class="linenos">  37</span>
<span class="linenos">  38</span><span class="kn">from</span><span class="w"> </span><span class="nn">skysim.colours</span><span class="w"> </span><span class="kn">import</span> <span class="n">InputColour</span><span class="p">,</span> <span class="n">RGBTuple</span><span class="p">,</span> <span class="n">convert_colour</span>
<span class="linenos">  39</span><span class="kn">from</span><span class="w"> </span><span class="nn">skysim.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">FloatArray</span><span class="p">,</span> <span class="n">IntArray</span>
<span class="linenos">  40</span>
<span class="linenos">  41</span><span class="c1"># Type Aliases</span>
<span class="linenos">  42</span>
<span class="linenos">  43</span>
<span class="linenos">  44</span><span class="nb">type</span> <span class="n">ConfigValue</span> <span class="o">=</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">date</span> <span class="o">|</span> <span class="n">time</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">InputColour</span><span class="p">]</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">[</span>
<span class="linenos">  45</span>    <span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">int</span>
<span class="linenos">  46</span><span class="p">]</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span><span class="p">]</span>
<span class="linenos">  47</span><span class="nb">type</span> <span class="n">ConfigMapping</span> <span class="o">=</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">ConfigValue</span><span class="p">]</span>
<span class="linenos">  48</span><span class="nb">type</span> <span class="n">TOMLConfig</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">[</span>  <span class="c1"># pylint: disable=invalid-name</span>
<span class="linenos">  49</span>    <span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">ConfigValue</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">ConfigValue</span><span class="p">]]</span>
<span class="linenos">  50</span><span class="p">]</span>
<span class="linenos">  51</span><span class="nb">type</span> <span class="n">SettingsPair</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">[</span><span class="s2">&quot;ImageSettings&quot;</span><span class="p">,</span> <span class="s2">&quot;PlotSettings&quot;</span><span class="p">]</span>
<span class="linenos">  52</span>
<span class="linenos">  53</span>
<span class="linenos">  54</span><span class="c1"># Constants</span>
<span class="linenos">  55</span>
<span class="linenos">  56</span>
<span class="linenos">  57</span><span class="n">DEFAULT_CONFIG_PATH</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;default.toml&quot;</span>
<span class="linenos">  58</span>
<span class="linenos">  59</span><span class="n">DATACLASS_CONFIG</span> <span class="o">=</span> <span class="n">ConfigDict</span><span class="p">(</span>
<span class="linenos">  60</span>    <span class="n">arbitrary_types_allowed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="linenos">  61</span>    <span class="n">extra</span><span class="o">=</span><span class="s2">&quot;forbid&quot;</span><span class="p">,</span>
<span class="linenos">  62</span>    <span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="linenos">  63</span><span class="p">)</span>
<span class="linenos">  64</span>
<span class="linenos">  65</span><span class="n">AIRY_DISK_RADIUS</span> <span class="o">=</span> <span class="mi">23</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">arcmin</span> <span class="o">/</span> <span class="mi">2</span>
<span class="linenos">  66</span><span class="sd">&quot;&quot;&quot;How far light from an object should spread. Based on the SIMBAD image of Vega.&quot;&quot;&quot;</span>
<span class="linenos">  67</span>
<span class="linenos">  68</span><span class="n">MAXIMUM_LIGHT_SPREAD</span> <span class="o">=</span> <span class="mi">10</span>
<span class="linenos">  69</span><span class="sd">&quot;&quot;&quot;Calculate the spread of light from an object out to this many standard deviations.&quot;&quot;&quot;</span>
<span class="linenos">  70</span>
<span class="linenos">  71</span>
<span class="linenos">  72</span><span class="c1"># Classes</span>
<span class="linenos">  73</span>
<span class="linenos">  74</span>
<div class="viewcode-block" id="Settings">
<a class="viewcode-back" href="../../generated/skysim.settings.Settings.html#skysim.settings.Settings">[docs]</a>
<span class="linenos">  75</span><span class="k">class</span><span class="w"> </span><span class="nc">Settings</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>  <span class="c1"># type: ignore[misc]</span>
<span class="linenos">  76</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Base class to interpret often-used configuration values. The `Settings`</span>
<span class="linenos">  77</span><span class="sd">    class should never be used or passed directly, but instead should be created</span>
<span class="linenos">  78</span><span class="sd">    only for the purpose of then calling `.get_image_settings()` and</span>
<span class="linenos">  79</span><span class="sd">    `.get_plot_settings()`.</span>
<span class="linenos">  80</span><span class="sd">    &quot;&quot;&quot;</span>
<span class="linenos">  81</span>
<span class="linenos">  82</span>    <span class="n">model_config</span> <span class="o">=</span> <span class="n">DATACLASS_CONFIG</span>
<span class="linenos">  83</span>
<span class="linenos">  84</span>    <span class="c1"># Stored on initialization</span>
<span class="linenos">  85</span>    <span class="n">input_location</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span>
<span class="linenos">  86</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;User-input version of the observing location.&quot;&quot;&quot;</span>
<span class="linenos">  87</span>
<span class="linenos">  88</span>    <span class="n">field_of_view</span><span class="p">:</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">[</span><span class="s2">&quot;angle&quot;</span><span class="p">]</span>  <span class="c1"># type: ignore[type-arg, name-defined]</span>
<span class="linenos">  89</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Diameter of the area being observed at any time.&quot;&quot;&quot;</span>
<span class="linenos">  90</span>
<span class="linenos">  91</span>    <span class="n">altitude_angle</span><span class="p">:</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">[</span><span class="s2">&quot;angle&quot;</span><span class="p">]</span>  <span class="c1"># type: ignore[type-arg, name-defined]</span>
<span class="linenos">  92</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Angle of observation (measured from horizon).&quot;&quot;&quot;</span>
<span class="linenos">  93</span>
<span class="linenos">  94</span>    <span class="n">azimuth_angle</span><span class="p">:</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">[</span><span class="s2">&quot;angle&quot;</span><span class="p">]</span>  <span class="c1"># type: ignore[type-arg, name-defined]</span>
<span class="linenos">  95</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Angle of observation (Eastwards from North).&quot;&quot;&quot;</span>
<span class="linenos">  96</span>    <span class="n">image_pixels</span><span class="p">:</span> <span class="n">PositiveInt</span>
<span class="linenos">  97</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Number of pixels (diameter) for the resulting image.&quot;&quot;&quot;</span>
<span class="linenos">  98</span>
<span class="linenos">  99</span>    <span class="c1"># Used to instantiate others, and stored, but hidden</span>
<span class="linenos"> 100</span>    <span class="n">start_date</span><span class="p">:</span> <span class="n">date</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="nb">repr</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="linenos"> 101</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Starting (local) date of observation.&quot;&quot;&quot;</span>
<span class="linenos"> 102</span>
<span class="linenos"> 103</span>    <span class="n">start_time</span><span class="p">:</span> <span class="n">time</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="nb">repr</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="linenos"> 104</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Starting (local) time of observation.&quot;&quot;&quot;</span>
<span class="linenos"> 105</span>
<span class="linenos"> 106</span>    <span class="n">snapshot_frequency</span><span class="p">:</span> <span class="n">timedelta</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="nb">repr</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="linenos"> 107</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;How often an observation should be taken - should be given in concert</span>
<span class="linenos"> 108</span><span class="sd">    with `duration` &quot;&quot;&quot;</span>
<span class="linenos"> 109</span>
<span class="linenos"> 110</span>    <span class="n">duration</span><span class="p">:</span> <span class="n">timedelta</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="nb">repr</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="linenos"> 111</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;How long the total observation should last - should be given in concert</span>
<span class="linenos"> 112</span><span class="sd">    with `snapshot_frequency`&quot;&quot;&quot;</span>
<span class="linenos"> 113</span>
<div class="viewcode-block" id="Settings.convert_to_deg">
<a class="viewcode-back" href="../../generated/skysim.settings.Settings.html#skysim.settings.Settings.convert_to_deg">[docs]</a>
<span class="linenos"> 114</span>    <span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;field_of_view&quot;</span><span class="p">,</span> <span class="s2">&quot;altitude_angle&quot;</span><span class="p">,</span> <span class="s2">&quot;azimuth_angle&quot;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;after&quot;</span><span class="p">)</span>
<span class="linenos"> 115</span>    <span class="nd">@classmethod</span>
<span class="linenos"> 116</span>    <span class="k">def</span><span class="w"> </span><span class="nf">convert_to_deg</span><span class="p">(</span>
<span class="linenos"> 117</span>        <span class="bp">cls</span><span class="p">,</span> <span class="n">angular</span><span class="p">:</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">[</span><span class="s2">&quot;angle&quot;</span><span class="p">]</span>  <span class="c1"># type: ignore[type-arg, name-defined]</span>
<span class="linenos"> 118</span>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">[</span><span class="s2">&quot;degree&quot;</span><span class="p">]:</span>  <span class="c1"># type: ignore[type-arg, name-defined]</span>
<span class="linenos"> 119</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert angular quantities to degrees.</span>
<span class="linenos"> 120</span>
<span class="linenos"> 121</span><span class="sd">        Parameters</span>
<span class="linenos"> 122</span><span class="sd">        ----------</span>
<span class="linenos"> 123</span><span class="sd">        angular : astropy.units.Quantity[angle]</span>
<span class="linenos"> 124</span><span class="sd">            Astropy angular quantity.</span>
<span class="linenos"> 125</span>
<span class="linenos"> 126</span><span class="sd">        Returns</span>
<span class="linenos"> 127</span><span class="sd">        -------</span>
<span class="linenos"> 128</span><span class="sd">        astropy.units.Quantity[degree]</span>
<span class="linenos"> 129</span><span class="sd">            Input angle in degrees.</span>
<span class="linenos"> 130</span><span class="sd">        &quot;&quot;&quot;</span>
<span class="linenos"> 131</span>        <span class="k">return</span> <span class="n">angular</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">)</span></div>

<span class="linenos"> 132</span>
<div class="viewcode-block" id="Settings.compare_timespans">
<a class="viewcode-back" href="../../generated/skysim.settings.Settings.html#skysim.settings.Settings.compare_timespans">[docs]</a>
<span class="linenos"> 133</span>    <span class="nd">@model_validator</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;after&quot;</span><span class="p">)</span>
<span class="linenos"> 134</span>    <span class="k">def</span><span class="w"> </span><span class="nf">compare_timespans</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
<span class="linenos"> 135</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 136</span><span class="sd">        Confirm that the time between snapshots is not greater than the observation</span>
<span class="linenos"> 137</span><span class="sd">        duration.</span>
<span class="linenos"> 138</span>
<span class="linenos"> 139</span><span class="sd">        Returns</span>
<span class="linenos"> 140</span><span class="sd">        -------</span>
<span class="linenos"> 141</span><span class="sd">        Self</span>
<span class="linenos"> 142</span><span class="sd">            `Settings` object.</span>
<span class="linenos"> 143</span>
<span class="linenos"> 144</span><span class="sd">        Raises</span>
<span class="linenos"> 145</span><span class="sd">        ------</span>
<span class="linenos"> 146</span><span class="sd">        ValueError</span>
<span class="linenos"> 147</span><span class="sd">            Raised if the snapshot frequency is greater than the duration.</span>
<span class="linenos"> 148</span><span class="sd">        &quot;&quot;&quot;</span>
<span class="linenos"> 149</span>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapshot_frequency</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">duration</span><span class="p">:</span>
<span class="linenos"> 150</span>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<span class="linenos"> 151</span>                <span class="s2">&quot;Frequency of snapshots (observation.interval) cannot be longer than &quot;</span>
<span class="linenos"> 152</span>                <span class="s2">&quot;observation.duration.&quot;</span>
<span class="linenos"> 153</span>            <span class="p">)</span>
<span class="linenos"> 154</span>        <span class="k">return</span> <span class="bp">self</span></div>

<span class="linenos"> 155</span>
<span class="linenos"> 156</span>    <span class="c1"># Derived and stored</span>
<span class="linenos"> 157</span>    <span class="nd">@computed_field</span><span class="p">()</span>
<span class="linenos"> 158</span>    <span class="nd">@cached_property</span>
<span class="linenos"> 159</span>    <span class="k">def</span><span class="w"> </span><span class="nf">frames</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PositiveInt</span><span class="p">:</span>
<span class="linenos"> 160</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 161</span><span class="sd">        Calculates number of frames for movie/observations to take.</span>
<span class="linenos"> 162</span>
<span class="linenos"> 163</span><span class="sd">        Returns</span>
<span class="linenos"> 164</span><span class="sd">        -------</span>
<span class="linenos"> 165</span><span class="sd">        pydantic.PositiveInt</span>
<span class="linenos"> 166</span><span class="sd">            Number of frames.</span>
<span class="linenos"> 167</span><span class="sd">        &quot;&quot;&quot;</span>
<span class="linenos"> 168</span>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapshot_frequency</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<span class="linenos"> 169</span>            <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">duration</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapshot_frequency</span><span class="p">)</span>
<span class="linenos"> 170</span>        <span class="k">return</span> <span class="mi">1</span>
<span class="linenos"> 171</span>
<span class="linenos"> 172</span>    <span class="nd">@computed_field</span><span class="p">()</span>
<span class="linenos"> 173</span>    <span class="nd">@cached_property</span>
<span class="linenos"> 174</span>    <span class="k">def</span><span class="w"> </span><span class="nf">earth_location</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">EarthLocation</span><span class="p">:</span>
<span class="linenos"> 175</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 176</span><span class="sd">        Looks up where on Earth the user requested the observation be taken from.</span>
<span class="linenos"> 177</span>
<span class="linenos"> 178</span><span class="sd">        Returns</span>
<span class="linenos"> 179</span><span class="sd">        -------</span>
<span class="linenos"> 180</span><span class="sd">        astropy.coordinates.EarthLocation</span>
<span class="linenos"> 181</span><span class="sd">            Astropy representation of location on Earth.</span>
<span class="linenos"> 182</span>
<span class="linenos"> 183</span><span class="sd">        Raises</span>
<span class="linenos"> 184</span><span class="sd">        ------</span>
<span class="linenos"> 185</span><span class="sd">        NotImplementedError</span>
<span class="linenos"> 186</span><span class="sd">            Raised if location lookup fails.</span>
<span class="linenos"> 187</span><span class="sd">        &quot;&quot;&quot;</span>
<span class="linenos"> 188</span>        <span class="k">try</span><span class="p">:</span>
<span class="linenos"> 189</span>            <span class="k">return</span> <span class="n">EarthLocation</span><span class="o">.</span><span class="n">of_address</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input_location</span><span class="p">)</span>
<span class="linenos"> 190</span>        <span class="k">except</span> <span class="n">NameResolveError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="linenos"> 191</span>            <span class="k">if</span> <span class="s2">&quot;connection&quot;</span> <span class="ow">in</span> <span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
<span class="linenos"> 192</span>                <span class="k">raise</span> <span class="ne">ConnectionError</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;address&quot;</span><span class="p">,</span> <span class="s2">&quot;location&quot;</span><span class="p">))</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
<span class="linenos"> 193</span>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;address&quot;</span><span class="p">,</span> <span class="s2">&quot;location&quot;</span><span class="p">))</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
<span class="linenos"> 194</span>
<span class="linenos"> 195</span>    <span class="nd">@computed_field</span><span class="p">()</span>
<span class="linenos"> 196</span>    <span class="nd">@cached_property</span>
<span class="linenos"> 197</span>    <span class="k">def</span><span class="w"> </span><span class="nf">timezone</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ZoneInfo</span><span class="p">:</span>
<span class="linenos"> 198</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 199</span><span class="sd">        Look up timezone based on Lat/Long.</span>
<span class="linenos"> 200</span>
<span class="linenos"> 201</span><span class="sd">        Returns</span>
<span class="linenos"> 202</span><span class="sd">        -------</span>
<span class="linenos"> 203</span><span class="sd">        zoneinfo.ZoneInfo</span>
<span class="linenos"> 204</span><span class="sd">            Timezone information.</span>
<span class="linenos"> 205</span>
<span class="linenos"> 206</span><span class="sd">        Raises</span>
<span class="linenos"> 207</span><span class="sd">        ------</span>
<span class="linenos"> 208</span><span class="sd">        NotImplementedError</span>
<span class="linenos"> 209</span><span class="sd">            Raised in the case that the lookup fails.</span>
<span class="linenos"> 210</span><span class="sd">        &quot;&quot;&quot;</span>
<span class="linenos"> 211</span>        <span class="n">lat</span><span class="p">,</span> <span class="n">lon</span> <span class="o">=</span> <span class="p">[</span>
<span class="linenos"> 212</span>            <span class="n">l</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
<span class="linenos"> 213</span>            <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">earth_location</span><span class="o">.</span><span class="n">lat</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">earth_location</span><span class="o">.</span><span class="n">lon</span><span class="p">]</span>
<span class="linenos"> 214</span>        <span class="p">]</span>
<span class="linenos"> 215</span>        <span class="n">tf</span> <span class="o">=</span> <span class="n">TimezoneFinder</span><span class="p">()</span>
<span class="linenos"> 216</span>        <span class="n">tzname</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">timezone_at</span><span class="p">(</span><span class="n">lat</span><span class="o">=</span><span class="n">lat</span><span class="p">,</span> <span class="n">lng</span><span class="o">=</span><span class="n">lon</span><span class="p">)</span>
<span class="linenos"> 217</span>        <span class="k">if</span> <span class="n">tzname</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos"> 218</span>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>  <span class="c1"># TODO: add test for this error</span>
<span class="linenos"> 219</span>                <span class="sa">f</span><span class="s2">&quot;Cannot determine timezone for </span><span class="si">{</span><span class="n">lat</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">lon</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">input_location</span><span class="si">}</span><span class="s2">)&quot;</span>
<span class="linenos"> 220</span>            <span class="p">)</span>
<span class="linenos"> 221</span>
<span class="linenos"> 222</span>        <span class="k">return</span> <span class="n">ZoneInfo</span><span class="p">(</span><span class="n">tzname</span><span class="p">)</span>
<span class="linenos"> 223</span>
<span class="linenos"> 224</span>    <span class="nd">@computed_field</span><span class="p">()</span>
<span class="linenos"> 225</span>    <span class="nd">@cached_property</span>
<span class="linenos"> 226</span>    <span class="k">def</span><span class="w"> </span><span class="nf">observation_times</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Time</span><span class="p">:</span>
<span class="linenos"> 227</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 228</span><span class="sd">        Calculates the times at which to take a snapshot.</span>
<span class="linenos"> 229</span>
<span class="linenos"> 230</span><span class="sd">        Returns</span>
<span class="linenos"> 231</span><span class="sd">        -------</span>
<span class="linenos"> 232</span><span class="sd">        astropy.time.Time</span>
<span class="linenos"> 233</span><span class="sd">            Astropy representation of one or more times.</span>
<span class="linenos"> 234</span><span class="sd">        &quot;&quot;&quot;</span>
<span class="linenos"> 235</span>        <span class="n">start_datetime</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span>
<span class="linenos"> 236</span>            <span class="n">year</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">start_date</span><span class="o">.</span><span class="n">year</span><span class="p">,</span>
<span class="linenos"> 237</span>            <span class="n">month</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">start_date</span><span class="o">.</span><span class="n">month</span><span class="p">,</span>
<span class="linenos"> 238</span>            <span class="n">day</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">start_date</span><span class="o">.</span><span class="n">day</span><span class="p">,</span>
<span class="linenos"> 239</span>            <span class="n">hour</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">start_time</span><span class="o">.</span><span class="n">hour</span><span class="p">,</span>
<span class="linenos"> 240</span>            <span class="n">minute</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">start_time</span><span class="o">.</span><span class="n">minute</span><span class="p">,</span>
<span class="linenos"> 241</span>            <span class="n">second</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">start_time</span><span class="o">.</span><span class="n">second</span><span class="p">,</span>
<span class="linenos"> 242</span>            <span class="n">microsecond</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">start_time</span><span class="o">.</span><span class="n">microsecond</span><span class="p">,</span>
<span class="linenos"> 243</span>            <span class="n">tzinfo</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">timezone</span><span class="p">,</span>
<span class="linenos"> 244</span>        <span class="p">)</span>
<span class="linenos"> 245</span>        <span class="k">return</span> <span class="n">Time</span><span class="p">(</span>
<span class="linenos"> 246</span>            <span class="p">[(</span><span class="n">start_datetime</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapshot_frequency</span> <span class="o">*</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frames</span><span class="p">)]</span>
<span class="linenos"> 247</span>        <span class="p">)</span>
<span class="linenos"> 248</span>
<span class="linenos"> 249</span>    <span class="nd">@computed_field</span><span class="p">()</span>
<span class="linenos"> 250</span>    <span class="nd">@cached_property</span>
<span class="linenos"> 251</span>    <span class="k">def</span><span class="w"> </span><span class="nf">observation_radec</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SkyCoord</span><span class="p">:</span>
<span class="linenos"> 252</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 253</span><span class="sd">        Calculates the observed RA/Dec position for each observation snapshot.</span>
<span class="linenos"> 254</span>
<span class="linenos"> 255</span><span class="sd">        Returns</span>
<span class="linenos"> 256</span><span class="sd">        -------</span>
<span class="linenos"> 257</span><span class="sd">        astropy.coordinates.SkyCoord</span>
<span class="linenos"> 258</span><span class="sd">            Astropy representation of one or more coordinates.</span>
<span class="linenos"> 259</span><span class="sd">        &quot;&quot;&quot;</span>
<span class="linenos"> 260</span>        <span class="n">earth_frame</span> <span class="o">=</span> <span class="n">AltAz</span><span class="p">(</span>
<span class="linenos"> 261</span>            <span class="n">obstime</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">observation_times</span><span class="p">,</span>
<span class="linenos"> 262</span>            <span class="n">az</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">azimuth_angle</span><span class="p">,</span>
<span class="linenos"> 263</span>            <span class="n">alt</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">altitude_angle</span><span class="p">,</span>
<span class="linenos"> 264</span>            <span class="n">location</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">earth_location</span><span class="p">,</span>
<span class="linenos"> 265</span>        <span class="p">)</span>
<span class="linenos"> 266</span>        <span class="k">return</span> <span class="n">SkyCoord</span><span class="p">(</span><span class="n">earth_frame</span><span class="o">.</span><span class="n">transform_to</span><span class="p">(</span><span class="n">ICRS</span><span class="p">()))</span>
<span class="linenos"> 267</span>
<span class="linenos"> 268</span>    <span class="nd">@computed_field</span><span class="p">()</span>
<span class="linenos"> 269</span>    <span class="nd">@cached_property</span>
<span class="linenos"> 270</span>    <span class="k">def</span><span class="w"> </span><span class="nf">degrees_per_pixel</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">[</span><span class="s2">&quot;angle&quot;</span><span class="p">]:</span>  <span class="c1"># type: ignore[type-arg, name-defined]</span>
<span class="linenos"> 271</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 272</span><span class="sd">        Calculates the number of degrees spanned by each pixel in the resulting image.</span>
<span class="linenos"> 273</span>
<span class="linenos"> 274</span><span class="sd">        Returns</span>
<span class="linenos"> 275</span><span class="sd">        -------</span>
<span class="linenos"> 276</span><span class="sd">        astropy.units.Quantity[angle]</span>
<span class="linenos"> 277</span><span class="sd">            Degrees per pixel (pixel considered unitless).</span>
<span class="linenos"> 278</span><span class="sd">        &quot;&quot;&quot;</span>
<span class="linenos"> 279</span>        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">field_of_view</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_pixels</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">)</span>
<span class="linenos"> 280</span>
<span class="linenos"> 281</span>    <span class="nd">@computed_field</span><span class="p">()</span>
<span class="linenos"> 282</span>    <span class="nd">@cached_property</span>
<span class="linenos"> 283</span>    <span class="k">def</span><span class="w"> </span><span class="nf">local_datetimes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">datetime</span><span class="p">]:</span>
<span class="linenos"> 284</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Observation snapshot times as timezone-aware python times.</span>
<span class="linenos"> 285</span>
<span class="linenos"> 286</span><span class="sd">        Returns</span>
<span class="linenos"> 287</span><span class="sd">        -------</span>
<span class="linenos"> 288</span><span class="sd">        list[datetime.time]</span>
<span class="linenos"> 289</span><span class="sd">            List of observation times.</span>
<span class="linenos"> 290</span><span class="sd">        &quot;&quot;&quot;</span>
<span class="linenos"> 291</span>        <span class="n">utc</span> <span class="o">=</span> <span class="p">[</span>
<span class="linenos"> 292</span>            <span class="n">t</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="n">ZoneInfo</span><span class="p">(</span><span class="s2">&quot;UTC&quot;</span><span class="p">))</span>
<span class="linenos"> 293</span>            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">observation_times</span>
<span class="linenos"> 294</span>        <span class="p">]</span>
<span class="linenos"> 295</span>        <span class="k">return</span> <span class="p">[</span><span class="n">u</span><span class="o">.</span><span class="n">astimezone</span><span class="p">(</span><span class="n">tz</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">timezone</span><span class="p">)</span> <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">utc</span><span class="p">]</span>
<span class="linenos"> 296</span>
<span class="linenos"> 297</span>    <span class="nd">@computed_field</span><span class="p">()</span>
<span class="linenos"> 298</span>    <span class="nd">@cached_property</span>
<span class="linenos"> 299</span>    <span class="k">def</span><span class="w"> </span><span class="nf">wcs_objects</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">WCS</span><span class="p">]:</span>
<span class="linenos"> 300</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;WCS objects for each timestep.</span>
<span class="linenos"> 301</span>
<span class="linenos"> 302</span><span class="sd">        Returns</span>
<span class="linenos"> 303</span><span class="sd">        -------</span>
<span class="linenos"> 304</span><span class="sd">        list[astropy.wcs.WCS]</span>
<span class="linenos"> 305</span><span class="sd">            WCS objects for each timestep.</span>
<span class="linenos"> 306</span><span class="sd">        &quot;&quot;&quot;</span>
<span class="linenos"> 307</span>        <span class="n">wcs_by_frame</span> <span class="o">=</span> <span class="p">[]</span>
<span class="linenos"> 308</span>        <span class="k">for</span> <span class="n">radec</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">observation_radec</span><span class="p">:</span>
<span class="linenos"> 309</span>            <span class="n">wcs</span> <span class="o">=</span> <span class="n">WCS</span><span class="p">(</span><span class="n">naxis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="linenos"> 310</span>            <span class="n">wcs</span><span class="o">.</span><span class="n">wcs</span><span class="o">.</span><span class="n">crpix</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">image_pixels</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span>
<span class="linenos"> 311</span>            <span class="n">wcs</span><span class="o">.</span><span class="n">wcs</span><span class="o">.</span><span class="n">cdelt</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">degrees_per_pixel</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">degrees_per_pixel</span><span class="o">.</span><span class="n">value</span><span class="p">]</span>
<span class="linenos"> 312</span>            <span class="n">wcs</span><span class="o">.</span><span class="n">wcs</span><span class="o">.</span><span class="n">crval</span> <span class="o">=</span> <span class="p">[</span><span class="n">radec</span><span class="o">.</span><span class="n">ra</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">radec</span><span class="o">.</span><span class="n">dec</span><span class="o">.</span><span class="n">value</span><span class="p">]</span>
<span class="linenos"> 313</span>            <span class="n">wcs</span><span class="o">.</span><span class="n">wcs</span><span class="o">.</span><span class="n">ctype</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;RA&quot;</span><span class="p">,</span> <span class="s2">&quot;DEC&quot;</span><span class="p">]</span>
<span class="linenos"> 314</span>            <span class="n">wcs</span><span class="o">.</span><span class="n">wcs</span><span class="o">.</span><span class="n">cunit</span> <span class="o">=</span> <span class="p">[</span><span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">]</span>
<span class="linenos"> 315</span>            <span class="n">wcs_by_frame</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">wcs</span><span class="p">)</span>
<span class="linenos"> 316</span>        <span class="k">return</span> <span class="n">wcs_by_frame</span>
<span class="linenos"> 317</span>
<span class="linenos"> 318</span>    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="s2">&quot;Settings&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="linenos"> 319</span>        <span class="n">result</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
<span class="linenos"> 320</span>        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_dump</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<span class="linenos"> 321</span>            <span class="n">v</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n\t</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos"> 322</span>            <span class="n">result</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
<span class="linenos"> 323</span>        <span class="k">return</span> <span class="n">result</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="linenos"> 324</span>
<div class="viewcode-block" id="Settings.get_image_settings">
<a class="viewcode-back" href="../../generated/skysim.settings.Settings.html#skysim.settings.Settings.get_image_settings">[docs]</a>
<span class="linenos"> 325</span>    <span class="k">def</span><span class="w"> </span><span class="nf">get_image_settings</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="s2">&quot;Settings&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;ImageSettings&quot;</span><span class="p">:</span>
<span class="linenos"> 326</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 327</span><span class="sd">        Generate an `ImageSettings` object inheriting this object&#39;s information.</span>
<span class="linenos"> 328</span>
<span class="linenos"> 329</span><span class="sd">        Parameters</span>
<span class="linenos"> 330</span><span class="sd">        ----------</span>
<span class="linenos"> 331</span><span class="sd">        **kwargs</span>
<span class="linenos"> 332</span><span class="sd">            Dictionary of arguments to be passed to `ImageSettings`.</span>
<span class="linenos"> 333</span>
<span class="linenos"> 334</span><span class="sd">        Returns</span>
<span class="linenos"> 335</span><span class="sd">        -------</span>
<span class="linenos"> 336</span><span class="sd">        ImageSettings</span>
<span class="linenos"> 337</span><span class="sd">            Object containing all passed configuration values as well as those from the</span>
<span class="linenos"> 338</span><span class="sd">            instantiation of this `Settings` object.</span>
<span class="linenos"> 339</span><span class="sd">        &quot;&quot;&quot;</span>
<span class="linenos"> 340</span>        <span class="k">return</span> <span class="n">ImageSettings</span><span class="p">(</span><span class="o">**</span><span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<span class="linenos"> 341</span>
<div class="viewcode-block" id="Settings.get_plot_settings">
<a class="viewcode-back" href="../../generated/skysim.settings.Settings.html#skysim.settings.Settings.get_plot_settings">[docs]</a>
<span class="linenos"> 342</span>    <span class="k">def</span><span class="w"> </span><span class="nf">get_plot_settings</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="s2">&quot;Settings&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;PlotSettings&quot;</span><span class="p">:</span>
<span class="linenos"> 343</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 344</span><span class="sd">        Generate an `PlotSettings` object inheriting this object&#39;s information.</span>
<span class="linenos"> 345</span>
<span class="linenos"> 346</span><span class="sd">        Parameters</span>
<span class="linenos"> 347</span><span class="sd">        ----------</span>
<span class="linenos"> 348</span><span class="sd">        **kwargs</span>
<span class="linenos"> 349</span><span class="sd">            Dictionary of arguments to be passed to `PlotSettings`.</span>
<span class="linenos"> 350</span>
<span class="linenos"> 351</span><span class="sd">        Returns</span>
<span class="linenos"> 352</span><span class="sd">        -------</span>
<span class="linenos"> 353</span><span class="sd">        PlotSettings</span>
<span class="linenos"> 354</span><span class="sd">            Object containing all passed configuration values as well as those from the</span>
<span class="linenos"> 355</span><span class="sd">            instantiation of this `Settings` object.</span>
<span class="linenos"> 356</span><span class="sd">        &quot;&quot;&quot;</span>
<span class="linenos"> 357</span>        <span class="k">return</span> <span class="n">PlotSettings</span><span class="p">(</span><span class="o">**</span><span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>
</div>

<span class="linenos"> 358</span>
<span class="linenos"> 359</span>
<div class="viewcode-block" id="ImageSettings">
<a class="viewcode-back" href="../../generated/skysim.settings.ImageSettings.html#skysim.settings.ImageSettings">[docs]</a>
<span class="linenos"> 360</span><span class="k">class</span><span class="w"> </span><span class="nc">ImageSettings</span><span class="p">(</span><span class="n">Settings</span><span class="p">):</span>  <span class="c1"># type: ignore[misc]</span>
<span class="linenos"> 361</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;`Settings` subclass to hold values used when populating the image array.</span>
<span class="linenos"> 362</span><span class="sd">    Additionally contains a copy of all attributes belonging to the `Settings` instance</span>
<span class="linenos"> 363</span><span class="sd">    it inherits from.</span>
<span class="linenos"> 364</span><span class="sd">    &quot;&quot;&quot;</span>
<span class="linenos"> 365</span>
<span class="linenos"> 366</span>    <span class="n">model_config</span> <span class="o">=</span> <span class="n">DATACLASS_CONFIG</span>
<span class="linenos"> 367</span>
<span class="linenos"> 368</span>    <span class="c1"># Stored on initialization</span>
<span class="linenos"> 369</span>    <span class="n">object_colours</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">RGBTuple</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
<span class="linenos"> 370</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Mapping between object types, and the colours to use on the image.&quot;&quot;&quot;</span>
<span class="linenos"> 371</span>
<span class="linenos"> 372</span>    <span class="c1"># Used to instantiate others</span>
<span class="linenos"> 373</span>    <span class="n">colour_values</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">RGBTuple</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="nb">repr</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="linenos"> 374</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;List of colours to use to fill out the background.&quot;&quot;&quot;</span>
<span class="linenos"> 375</span>
<span class="linenos"> 376</span>    <span class="n">colour_time_indices</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="nb">repr</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="linenos"> 377</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Mapping between hour of the day (0-24, float) and the index corresponding</span>
<span class="linenos"> 378</span><span class="sd">        to the colour in `colour_values` to use at that time.&quot;&quot;&quot;</span>
<span class="linenos"> 379</span>
<span class="linenos"> 380</span>    <span class="n">magnitude_values</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="nb">repr</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="linenos"> 381</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;List of maximum magnitude values, to be used in the same manner as</span>
<span class="linenos"> 382</span><span class="sd">    `colour_values`.&quot;&quot;&quot;</span>
<span class="linenos"> 383</span>
<span class="linenos"> 384</span>    <span class="n">magnitude_time_indices</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="nb">repr</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="linenos"> 385</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Same as `colour_time_indices`, except applying to magnitude_values. Need not be</span>
<span class="linenos"> 386</span><span class="sd">        the same as `colour_time_indices`.&quot;&quot;&quot;</span>
<span class="linenos"> 387</span>
<span class="linenos"> 388</span>    <span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;object_colours&quot;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;before&quot;</span><span class="p">)</span>
<span class="linenos"> 389</span>    <span class="nd">@classmethod</span>
<span class="linenos"> 390</span>    <span class="k">def</span><span class="w"> </span><span class="nf">_convert_colour_dict</span><span class="p">(</span>  <span class="c1"># type: ignore[misc]</span>
<span class="linenos"> 391</span>        <span class="bp">cls</span><span class="p">,</span> <span class="n">colour_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
<span class="linenos"> 392</span>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">RGBTuple</span><span class="p">]:</span>
<span class="linenos"> 393</span>        <span class="k">return</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">convert_colour</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">colour_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
<span class="linenos"> 394</span>
<span class="linenos"> 395</span>    <span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;colour_values&quot;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;before&quot;</span><span class="p">)</span>
<span class="linenos"> 396</span>    <span class="nd">@classmethod</span>
<span class="linenos"> 397</span>    <span class="k">def</span><span class="w"> </span><span class="nf">_convert_colour_list</span><span class="p">(</span>  <span class="c1"># type: ignore[misc]</span>
<span class="linenos"> 398</span>        <span class="bp">cls</span><span class="p">,</span> <span class="n">colour_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span>
<span class="linenos"> 399</span>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">RGBTuple</span><span class="p">]:</span>
<span class="linenos"> 400</span>        <span class="k">return</span> <span class="p">[</span><span class="n">convert_colour</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">colour_list</span><span class="p">]</span>
<span class="linenos"> 401</span>
<span class="linenos"> 402</span>    <span class="c1"># Derived and stored</span>
<span class="linenos"> 403</span>    <span class="nd">@computed_field</span><span class="p">()</span>
<span class="linenos"> 404</span>    <span class="nd">@cached_property</span>
<span class="linenos"> 405</span>    <span class="k">def</span><span class="w"> </span><span class="nf">maximum_magnitude</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="linenos"> 406</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;The highest magnitude that will ever be visible in the image.</span>
<span class="linenos"> 407</span>
<span class="linenos"> 408</span><span class="sd">        Returns</span>
<span class="linenos"> 409</span><span class="sd">        -------</span>
<span class="linenos"> 410</span><span class="sd">        float</span>
<span class="linenos"> 411</span><span class="sd">            Magnitude.</span>
<span class="linenos"> 412</span><span class="sd">        &quot;&quot;&quot;</span>
<span class="linenos"> 413</span>        <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">magnitude_values</span><span class="p">)</span>
<span class="linenos"> 414</span>
<span class="linenos"> 415</span>    <span class="nd">@computed_field</span><span class="p">()</span>
<span class="linenos"> 416</span>    <span class="nd">@cached_property</span>
<span class="linenos"> 417</span>    <span class="k">def</span><span class="w"> </span><span class="nf">colour_mapping</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">LinearSegmentedColormap</span><span class="p">:</span>
<span class="linenos"> 418</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Interpolate between the colour-time mappings indicated by `colour_values` and</span>
<span class="linenos"> 419</span><span class="sd">        `colour_time_indices` to generate an addressable mapping.</span>
<span class="linenos"> 420</span>
<span class="linenos"> 421</span><span class="sd">        Returns</span>
<span class="linenos"> 422</span><span class="sd">        -------</span>
<span class="linenos"> 423</span><span class="sd">        matplotlib.colors.LinearSegmentedColormap</span>
<span class="linenos"> 424</span><span class="sd">            Callable object on the interval [0,1] returning a RGBTuple.</span>
<span class="linenos"> 425</span><span class="sd">        &quot;&quot;&quot;</span>
<span class="linenos"> 426</span>        <span class="n">colour_by_time</span> <span class="o">=</span> <span class="p">[</span>
<span class="linenos"> 427</span>            <span class="p">(</span><span class="n">hour</span> <span class="o">/</span> <span class="mi">24</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">colour_values</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
<span class="linenos"> 428</span>            <span class="k">for</span> <span class="n">hour</span><span class="p">,</span> <span class="n">index</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">colour_time_indices</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
<span class="linenos"> 429</span>        <span class="p">]</span>
<span class="linenos"> 430</span>        <span class="k">return</span> <span class="n">LinearSegmentedColormap</span><span class="o">.</span><span class="n">from_list</span><span class="p">(</span><span class="s2">&quot;sky&quot;</span><span class="p">,</span> <span class="n">colour_by_time</span><span class="p">)</span>
<span class="linenos"> 431</span>
<span class="linenos"> 432</span>    <span class="nd">@computed_field</span><span class="p">()</span>
<span class="linenos"> 433</span>    <span class="nd">@cached_property</span>
<span class="linenos"> 434</span>    <span class="k">def</span><span class="w"> </span><span class="nf">magnitude_mapping</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FloatArray</span><span class="p">:</span>
<span class="linenos"> 435</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Interpolate between the magnitude-time mappings indicated by</span>
<span class="linenos"> 436</span><span class="sd">        `magnitude_values` and `magnitude_time_indices` to generate an addressable</span>
<span class="linenos"> 437</span><span class="sd">        mapping.</span>
<span class="linenos"> 438</span>
<span class="linenos"> 439</span><span class="sd">        Returns</span>
<span class="linenos"> 440</span><span class="sd">        -------</span>
<span class="linenos"> 441</span><span class="sd">        FloatArray</span>
<span class="linenos"> 442</span><span class="sd">            Array containing the calculated magnitude value for each second of the day.</span>
<span class="linenos"> 443</span><span class="sd">        &quot;&quot;&quot;</span>
<span class="linenos"> 444</span>        <span class="n">magnitude_day_percentage</span> <span class="o">=</span> <span class="p">[</span>
<span class="linenos"> 445</span>            <span class="n">hour</span> <span class="o">/</span> <span class="mi">24</span> <span class="k">for</span> <span class="n">hour</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">magnitude_time_indices</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<span class="linenos"> 446</span>        <span class="p">]</span>
<span class="linenos"> 447</span>        <span class="n">magnitude_by_time</span> <span class="o">=</span> <span class="p">[</span>
<span class="linenos"> 448</span>            <span class="bp">self</span><span class="o">.</span><span class="n">magnitude_values</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
<span class="linenos"> 449</span>            <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">magnitude_time_indices</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
<span class="linenos"> 450</span>        <span class="p">]</span>
<span class="linenos"> 451</span>        <span class="n">day_percentages</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">24</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
<span class="linenos"> 452</span>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">day_percentages</span><span class="p">,</span> <span class="n">magnitude_day_percentage</span><span class="p">,</span> <span class="n">magnitude_by_time</span><span class="p">)</span>
<span class="linenos"> 453</span>
<span class="linenos"> 454</span>    <span class="nd">@computed_field</span><span class="p">()</span>
<span class="linenos"> 455</span>    <span class="nd">@cached_property</span>
<span class="linenos"> 456</span>    <span class="k">def</span><span class="w"> </span><span class="nf">light_spread_stddev</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PositiveFloat</span><span class="p">:</span>
<span class="linenos"> 457</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Standard deviation for the Gaussian which defines the spread of starlight.</span>
<span class="linenos"> 458</span>
<span class="linenos"> 459</span><span class="sd">        Returns</span>
<span class="linenos"> 460</span><span class="sd">        -------</span>
<span class="linenos"> 461</span><span class="sd">        pydantic.PositiveFloat</span>
<span class="linenos"> 462</span><span class="sd">            Standard deviation.</span>
<span class="linenos"> 463</span><span class="sd">        &quot;&quot;&quot;</span>
<span class="linenos"> 464</span>        <span class="n">airy_disk_pixels</span> <span class="o">=</span> <span class="n">AIRY_DISK_RADIUS</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">degrees_per_pixel</span>
<span class="linenos"> 465</span>        <span class="n">airy_disk_pixels</span> <span class="o">=</span> <span class="n">airy_disk_pixels</span><span class="o">.</span><span class="n">decompose</span><span class="p">()</span>
<span class="linenos"> 466</span>
<span class="linenos"> 467</span>        <span class="c1"># assume the airy disk is at 3x standard deviation of the Gaussian</span>
<span class="linenos"> 468</span>        <span class="n">std_dev</span> <span class="o">=</span> <span class="n">airy_disk_pixels</span> <span class="o">/</span> <span class="mi">3</span>
<span class="linenos"> 469</span>
<span class="linenos"> 470</span>        <span class="c1"># standard deviation is &quot;diameter&quot; whilst airy is &quot;radius&quot;</span>
<span class="linenos"> 471</span>        <span class="n">std_dev</span> <span class="o">*=</span> <span class="mi">2</span>
<span class="linenos"> 472</span>
<span class="linenos"> 473</span>        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">std_dev</span><span class="p">)</span>
<span class="linenos"> 474</span>
<span class="linenos"> 475</span>    <span class="nd">@computed_field</span><span class="p">()</span>
<span class="linenos"> 476</span>    <span class="nd">@cached_property</span>
<span class="linenos"> 477</span>    <span class="k">def</span><span class="w"> </span><span class="nf">area_mesh</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">IntArray</span><span class="p">:</span>
<span class="linenos"> 478</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a mesh of indices that spread out from a central point.</span>
<span class="linenos"> 479</span>
<span class="linenos"> 480</span><span class="sd">        Returns</span>
<span class="linenos"> 481</span><span class="sd">        -------</span>
<span class="linenos"> 482</span><span class="sd">        IntArray</span>
<span class="linenos"> 483</span><span class="sd">            (2, X, X) array.</span>
<span class="linenos"> 484</span><span class="sd">        &quot;&quot;&quot;</span>
<span class="linenos"> 485</span>        <span class="n">maximum_radius</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span>
<span class="linenos"> 486</span>            <span class="n">MAXIMUM_LIGHT_SPREAD</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">light_spread_stddev</span>
<span class="linenos"> 487</span>        <span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="linenos"> 488</span>
<span class="linenos"> 489</span>        <span class="n">radius_vector</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="n">maximum_radius</span><span class="p">,</span> <span class="n">maximum_radius</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<span class="linenos"> 490</span>
<span class="linenos"> 491</span>        <span class="c1"># mesh of points which will map to the region around the star</span>
<span class="linenos"> 492</span>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">radius_vector</span><span class="p">,</span> <span class="n">radius_vector</span><span class="p">))</span>
<span class="linenos"> 493</span>
<span class="linenos"> 494</span>    <span class="nd">@computed_field</span><span class="p">()</span>
<span class="linenos"> 495</span>    <span class="nd">@cached_property</span>
<span class="linenos"> 496</span>    <span class="k">def</span><span class="w"> </span><span class="nf">brightness_scale_mesh</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FloatArray</span><span class="p">:</span>
<span class="linenos"> 497</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a mesh of scaling factors that will dictate how a star&#39;s light</span>
<span class="linenos"> 498</span><span class="sd">        falls off with distance.</span>
<span class="linenos"> 499</span>
<span class="linenos"> 500</span><span class="sd">        Returns</span>
<span class="linenos"> 501</span><span class="sd">        -------</span>
<span class="linenos"> 502</span><span class="sd">        FloatArray</span>
<span class="linenos"> 503</span><span class="sd">            2D mesh of [0,1] values.</span>
<span class="linenos"> 504</span><span class="sd">        &quot;&quot;&quot;</span>
<span class="linenos"> 505</span>
<span class="linenos"> 506</span>        <span class="c1"># radius measurement at each mesh point</span>
<span class="linenos"> 507</span>        <span class="n">radial_distance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">area_mesh</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">area_mesh</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
<span class="linenos"> 508</span>
<span class="linenos"> 509</span>        <span class="n">unique_radii</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">radial_distance</span><span class="p">)</span>
<span class="linenos"> 510</span>
<span class="linenos"> 511</span>        <span class="c1"># all of the locations where each unique radius is found</span>
<span class="linenos"> 512</span>        <span class="n">radius_locations</span> <span class="o">=</span> <span class="p">[]</span>
<span class="linenos"> 513</span>        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">unique_radii</span><span class="p">:</span>
<span class="linenos"> 514</span>            <span class="n">locations</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">radial_distance</span> <span class="o">==</span> <span class="n">r</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>
<span class="linenos"> 515</span>            <span class="n">radius_locations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">locations</span><span class="p">)</span>
<span class="linenos"> 516</span>
<span class="linenos"> 517</span>        <span class="n">mesh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">area_mesh</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>  <span class="c1"># instantiate brightness_scale_mesh</span>
<span class="linenos"> 518</span>
<span class="linenos"> 519</span>        <span class="k">for</span> <span class="n">r</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">unique_radii</span><span class="p">,</span> <span class="n">radius_locations</span><span class="p">):</span>
<span class="linenos"> 520</span>            <span class="n">brightness_scale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">brightness_gaussian</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
<span class="linenos"> 521</span>            <span class="c1"># TODO: remove this loop by using a smarter numpy-based way to store</span>
<span class="linenos"> 522</span>            <span class="c1"># radius_locations entries</span>
<span class="linenos"> 523</span>            <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>
<span class="linenos"> 524</span>                <span class="n">mesh</span><span class="p">[</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">brightness_scale</span>
<span class="linenos"> 525</span>
<span class="linenos"> 526</span>        <span class="k">return</span> <span class="n">mesh</span>
<span class="linenos"> 527</span>
<div class="viewcode-block" id="ImageSettings.brightness_gaussian">
<a class="viewcode-back" href="../../generated/skysim.settings.ImageSettings.html#skysim.settings.ImageSettings.brightness_gaussian">[docs]</a>
<span class="linenos"> 528</span>    <span class="k">def</span><span class="w"> </span><span class="nf">brightness_gaussian</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">radius</span><span class="p">:</span> <span class="n">NonNegativeFloat</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NonNegativeFloat</span><span class="p">:</span>
<span class="linenos"> 529</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate how much light is observed from a star at some radius away</span>
<span class="linenos"> 530</span><span class="sd">        from it.</span>
<span class="linenos"> 531</span>
<span class="linenos"> 532</span><span class="sd">        Parameters</span>
<span class="linenos"> 533</span><span class="sd">        ----------</span>
<span class="linenos"> 534</span><span class="sd">        radius : pydantic.NonNegativeFloat</span>
<span class="linenos"> 535</span><span class="sd">            Distance in pixels.</span>
<span class="linenos"> 536</span>
<span class="linenos"> 537</span><span class="sd">        Returns</span>
<span class="linenos"> 538</span><span class="sd">        -------</span>
<span class="linenos"> 539</span><span class="sd">        pydantic.NonNegativeFloat</span>
<span class="linenos"> 540</span><span class="sd">            Scaling factor for brightness.</span>
<span class="linenos"> 541</span><span class="sd">        &quot;&quot;&quot;</span>
<span class="linenos"> 542</span>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">radius</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">light_spread_stddev</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span></div>
</div>

<span class="linenos"> 543</span>
<span class="linenos"> 544</span>
<div class="viewcode-block" id="PlotSettings">
<a class="viewcode-back" href="../../generated/skysim.settings.PlotSettings.html#skysim.settings.PlotSettings">[docs]</a>
<span class="linenos"> 545</span><span class="k">class</span><span class="w"> </span><span class="nc">PlotSettings</span><span class="p">(</span><span class="n">Settings</span><span class="p">):</span>  <span class="c1"># type: ignore[misc]</span>
<span class="linenos"> 546</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;`Settings` subclass to hold values used when generating the final plot</span>
<span class="linenos"> 547</span><span class="sd">    Additionally contains a copy of all attributes belonging to the `Settings` instance</span>
<span class="linenos"> 548</span><span class="sd">    it inherits from.</span>
<span class="linenos"> 549</span><span class="sd">    &quot;&quot;&quot;</span>
<span class="linenos"> 550</span>
<span class="linenos"> 551</span>    <span class="n">model_config</span> <span class="o">=</span> <span class="n">DATACLASS_CONFIG</span>
<span class="linenos"> 552</span>
<span class="linenos"> 553</span>    <span class="c1"># Stored on initialization</span>
<span class="linenos"> 554</span>    <span class="n">fps</span><span class="p">:</span> <span class="n">NonNegativeFloat</span>
<span class="linenos"> 555</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Frames per second of the GIF/video generated. Zero if there is only one</span>
<span class="linenos"> 556</span><span class="sd">    frame.&quot;&quot;&quot;</span>
<span class="linenos"> 557</span>
<span class="linenos"> 558</span>    <span class="n">filename</span><span class="p">:</span> <span class="n">Path</span>
<span class="linenos"> 559</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Location to save the plot.&quot;&quot;&quot;</span>
<span class="linenos"> 560</span>
<span class="linenos"> 561</span>    <span class="n">figure_size</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">PositiveFloat</span><span class="p">,</span> <span class="n">PositiveFloat</span><span class="p">]</span>
<span class="linenos"> 562</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Size of the figure in inches to pass to `matplotlib`.&quot;&quot;&quot;</span>
<span class="linenos"> 563</span>
<span class="linenos"> 564</span>    <span class="n">dpi</span><span class="p">:</span> <span class="n">PositiveInt</span>
<span class="linenos"> 565</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Dots per inch, passed to `matplotlib`.&quot;&quot;&quot;</span>
<span class="linenos"> 566</span>
<span class="linenos"> 567</span>    <span class="nd">@computed_field</span><span class="p">()</span>
<span class="linenos"> 568</span>    <span class="nd">@cached_property</span>
<span class="linenos"> 569</span>    <span class="k">def</span><span class="w"> </span><span class="nf">observation_info</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="linenos"> 570</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate a string containing information about the observation for the plot.</span>
<span class="linenos"> 571</span><span class="sd">        Only contains information which is constant throughout all snapshots.</span>
<span class="linenos"> 572</span>
<span class="linenos"> 573</span><span class="sd">        Returns</span>
<span class="linenos"> 574</span><span class="sd">        -------</span>
<span class="linenos"> 575</span><span class="sd">        str</span>
<span class="linenos"> 576</span><span class="sd">            Formatted string.</span>
<span class="linenos"> 577</span><span class="sd">        &quot;&quot;&quot;</span>
<span class="linenos"> 578</span>        <span class="n">altitude</span> <span class="o">=</span> <span class="n">angle_to_dms</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">altitude_angle</span><span class="p">)</span>
<span class="linenos"> 579</span>        <span class="n">azimuth</span> <span class="o">=</span> <span class="n">angle_to_dms</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">azimuth_angle</span><span class="p">)</span>
<span class="linenos"> 580</span>        <span class="n">fov</span> <span class="o">=</span> <span class="n">angle_to_dms</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">field_of_view</span><span class="p">)</span>
<span class="linenos"> 581</span>        <span class="k">return</span> <span class="p">(</span>
<span class="linenos"> 582</span>            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">input_location</span><span class="si">}</span><span class="se">\n</span><span class="s2"> Altitude: </span><span class="si">{</span><span class="n">altitude</span><span class="si">}</span><span class="s2">, &quot;</span>
<span class="linenos"> 583</span>            <span class="sa">f</span><span class="s2">&quot;Azimuth: </span><span class="si">{</span><span class="n">azimuth</span><span class="si">}</span><span class="s2">, FOV: </span><span class="si">{</span><span class="n">fov</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="linenos"> 584</span>        <span class="p">)</span>
<span class="linenos"> 585</span>
<span class="linenos"> 586</span>    <span class="nd">@computed_field</span>
<span class="linenos"> 587</span>    <span class="nd">@cached_property</span>
<span class="linenos"> 588</span>    <span class="k">def</span><span class="w"> </span><span class="nf">datetime_strings</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="linenos"> 589</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Printable observation times.</span>
<span class="linenos"> 590</span>
<span class="linenos"> 591</span><span class="sd">        Returns</span>
<span class="linenos"> 592</span><span class="sd">        -------</span>
<span class="linenos"> 593</span><span class="sd">        list[str]</span>
<span class="linenos"> 594</span><span class="sd">            List of strings for each time.</span>
<span class="linenos"> 595</span><span class="sd">        &quot;&quot;&quot;</span>
<span class="linenos"> 596</span>        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_time</span><span class="o">.</span><span class="n">second</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">divmod</span><span class="p">(</span>
<span class="linenos"> 597</span>            <span class="bp">self</span><span class="o">.</span><span class="n">snapshot_frequency</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">(),</span> <span class="mi">60</span>
<span class="linenos"> 598</span>        <span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<span class="linenos"> 599</span>            <span class="n">fmt_string</span> <span class="o">=</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M %Z&quot;</span>
<span class="linenos"> 600</span>        <span class="k">else</span><span class="p">:</span>
<span class="linenos"> 601</span>            <span class="n">fmt_string</span> <span class="o">=</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> </span><span class="si">%X</span><span class="s2"> %Z&quot;</span>
<span class="linenos"> 602</span>
<span class="linenos"> 603</span>        <span class="k">return</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">fmt_string</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">local_datetimes</span><span class="p">]</span>
<span class="linenos"> 604</span>
<span class="linenos"> 605</span>    <span class="nd">@computed_field</span>
<span class="linenos"> 606</span>    <span class="nd">@cached_property</span>
<span class="linenos"> 607</span>    <span class="k">def</span><span class="w"> </span><span class="nf">tempfile_path</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Path</span><span class="p">:</span>
<span class="linenos"> 608</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Path to store video frame files.</span>
<span class="linenos"> 609</span>
<span class="linenos"> 610</span><span class="sd">        Returns</span>
<span class="linenos"> 611</span><span class="sd">        -------</span>
<span class="linenos"> 612</span><span class="sd">        pathlib.Path</span>
<span class="linenos"> 613</span><span class="sd">            Directory.</span>
<span class="linenos"> 614</span><span class="sd">        &quot;&quot;&quot;</span>
<span class="linenos"> 615</span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;SkySimFiles&quot;</span>
<span class="linenos"> 616</span>
<span class="linenos"> 617</span>    <span class="nd">@computed_field</span>
<span class="linenos"> 618</span>    <span class="nd">@cached_property</span>
<span class="linenos"> 619</span>    <span class="k">def</span><span class="w"> </span><span class="nf">tempfile_zfill</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="linenos"> 620</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;How much zero-padding to use when writing the video frame filenames.</span>
<span class="linenos"> 621</span>
<span class="linenos"> 622</span><span class="sd">        Returns</span>
<span class="linenos"> 623</span><span class="sd">        -------</span>
<span class="linenos"> 624</span><span class="sd">        int</span>
<span class="linenos"> 625</span><span class="sd">            Number of digits.</span>
<span class="linenos"> 626</span><span class="sd">        &quot;&quot;&quot;</span>
<span class="linenos"> 627</span>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frames</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="linenos"> 628</span>
<div class="viewcode-block" id="PlotSettings.check_parent_directory_exists">
<a class="viewcode-back" href="../../generated/skysim.settings.PlotSettings.html#skysim.settings.PlotSettings.check_parent_directory_exists">[docs]</a>
<span class="linenos"> 629</span>    <span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;filename&quot;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;after&quot;</span><span class="p">)</span>
<span class="linenos"> 630</span>    <span class="nd">@classmethod</span>
<span class="linenos"> 631</span>    <span class="k">def</span><span class="w"> </span><span class="nf">check_parent_directory_exists</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Path</span><span class="p">:</span>
<span class="linenos"> 632</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Raise an error if the directory in which to save the image doesn&#39;t exist.</span>
<span class="linenos"> 633</span>
<span class="linenos"> 634</span><span class="sd">        Parameters</span>
<span class="linenos"> 635</span><span class="sd">        ----------</span>
<span class="linenos"> 636</span><span class="sd">        filename : pathlib.Path</span>
<span class="linenos"> 637</span><span class="sd">            Location to save image.</span>
<span class="linenos"> 638</span>
<span class="linenos"> 639</span><span class="sd">        Returns</span>
<span class="linenos"> 640</span><span class="sd">        -------</span>
<span class="linenos"> 641</span><span class="sd">        pathlib.Path :</span>
<span class="linenos"> 642</span><span class="sd">            Same as input.</span>
<span class="linenos"> 643</span>
<span class="linenos"> 644</span><span class="sd">        Raises</span>
<span class="linenos"> 645</span><span class="sd">        ------</span>
<span class="linenos"> 646</span><span class="sd">        ValueError</span>
<span class="linenos"> 647</span><span class="sd">            Raised if parent directory does not exist.</span>
<span class="linenos"> 648</span><span class="sd">        &quot;&quot;&quot;</span>
<span class="linenos"> 649</span>
<span class="linenos"> 650</span>        <span class="k">if</span> <span class="ow">not</span> <span class="n">filename</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
<span class="linenos"> 651</span>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<span class="linenos"> 652</span>                <span class="sa">f</span><span class="s2">&quot;Cannot save result &#39;</span><span class="si">{</span><span class="n">filename</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span><span class="si">}</span><span class="s2">&#39; because parent directory &quot;</span>
<span class="linenos"> 653</span>                <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">filename</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span><span class="si">}</span><span class="s2">&#39; does not exist.&quot;</span>
<span class="linenos"> 654</span>            <span class="p">)</span>
<span class="linenos"> 655</span>        <span class="k">return</span> <span class="n">filename</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span></div>

<span class="linenos"> 656</span>
<div class="viewcode-block" id="PlotSettings.validate_fps">
<a class="viewcode-back" href="../../generated/skysim.settings.PlotSettings.html#skysim.settings.PlotSettings.validate_fps">[docs]</a>
<span class="linenos"> 657</span>    <span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;fps&quot;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;after&quot;</span><span class="p">)</span>
<span class="linenos"> 658</span>    <span class="nd">@classmethod</span>
<span class="linenos"> 659</span>    <span class="k">def</span><span class="w"> </span><span class="nf">validate_fps</span><span class="p">(</span>
<span class="linenos"> 660</span>        <span class="bp">cls</span><span class="p">,</span> <span class="n">input_fps</span><span class="p">:</span> <span class="n">NonNegativeFloat</span><span class="p">,</span> <span class="n">info</span><span class="p">:</span> <span class="n">ValidationInfo</span>
<span class="linenos"> 661</span>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NonNegativeFloat</span><span class="p">:</span>
<span class="linenos"> 662</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Ensure fps conforms to the described requirements.</span>
<span class="linenos"> 663</span>
<span class="linenos"> 664</span><span class="sd">        Parameters</span>
<span class="linenos"> 665</span><span class="sd">        ----------</span>
<span class="linenos"> 666</span><span class="sd">        input_fps : pydantic.NonNegativeFloat</span>
<span class="linenos"> 667</span><span class="sd">            Frames per second as input when instantiating the `PlotSettings` object.</span>
<span class="linenos"> 668</span><span class="sd">        info : pydantic.ValidationInfo</span>
<span class="linenos"> 669</span><span class="sd">            Pydantic `ValidationInfo` object allowing access to the other</span>
<span class="linenos"> 670</span><span class="sd">            already-validated fields.</span>
<span class="linenos"> 671</span>
<span class="linenos"> 672</span><span class="sd">        Returns</span>
<span class="linenos"> 673</span><span class="sd">        -------</span>
<span class="linenos"> 674</span><span class="sd">        pydantic.NonNegativeFloat</span>
<span class="linenos"> 675</span><span class="sd">            Validated fps.</span>
<span class="linenos"> 676</span>
<span class="linenos"> 677</span><span class="sd">        Raises</span>
<span class="linenos"> 678</span><span class="sd">        ------</span>
<span class="linenos"> 679</span><span class="sd">        ValueError</span>
<span class="linenos"> 680</span><span class="sd">            Raised if `fps` is given as zero but the observation `duration` implies</span>
<span class="linenos"> 681</span><span class="sd">            there should be multiple frames.</span>
<span class="linenos"> 682</span><span class="sd">        &quot;&quot;&quot;</span>
<span class="linenos"> 683</span>        <span class="k">if</span> <span class="n">info</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;duration&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<span class="linenos"> 684</span>            <span class="k">return</span> <span class="mi">0</span>
<span class="linenos"> 685</span>        <span class="k">if</span> <span class="n">input_fps</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<span class="linenos"> 686</span>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<span class="linenos"> 687</span>                <span class="sa">f</span><span class="s2">&quot;Non-zero duration (</span><span class="si">{</span><span class="n">info</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;duration&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">) implies the &quot;</span>
<span class="linenos"> 688</span>                <span class="s2">&quot;creation of a movie, but the given fps was zero.&quot;</span>
<span class="linenos"> 689</span>            <span class="p">)</span>
<span class="linenos"> 690</span>        <span class="k">return</span> <span class="n">input_fps</span></div>
</div>

<span class="linenos"> 691</span>
<span class="linenos"> 692</span>
<span class="linenos"> 693</span><span class="c1"># Methods</span>
<span class="linenos"> 694</span>
<span class="linenos"> 695</span>
<span class="linenos"> 696</span><span class="c1">## Top-Level Settings Methods</span>
<span class="linenos"> 697</span>
<span class="linenos"> 698</span>
<div class="viewcode-block" id="load_from_toml">
<a class="viewcode-back" href="../../generated/skysim.settings.load_from_toml.html#skysim.settings.load_from_toml">[docs]</a>
<span class="linenos"> 699</span><span class="k">def</span><span class="w"> </span><span class="nf">load_from_toml</span><span class="p">(</span>
<span class="linenos"> 700</span>    <span class="n">filename</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">return_settings</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="linenos"> 701</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Settings</span> <span class="o">|</span> <span class="n">SettingsPair</span><span class="p">:</span>
<span class="linenos"> 702</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Load configuration options from a TOML file and parse them into `Settings`</span>
<span class="linenos"> 703</span><span class="sd">    objects.</span>
<span class="linenos"> 704</span>
<span class="linenos"> 705</span><span class="sd">    Parameters</span>
<span class="linenos"> 706</span><span class="sd">    ----------</span>
<span class="linenos"> 707</span><span class="sd">    filename : str</span>
<span class="linenos"> 708</span><span class="sd">        Location of the configuration file.</span>
<span class="linenos"> 709</span><span class="sd">    return_settings : bool, optional</span>
<span class="linenos"> 710</span><span class="sd">        Whether to return the `Settings` object (`True`) or `ImageSettings` and</span>
<span class="linenos"> 711</span><span class="sd">        `PlotSettings` objects (`False`). Default `False`.</span>
<span class="linenos"> 712</span>
<span class="linenos"> 713</span><span class="sd">    Returns</span>
<span class="linenos"> 714</span><span class="sd">    -------</span>
<span class="linenos"> 715</span><span class="sd">    tuple[ImageSettings, PlotSettings]</span>
<span class="linenos"> 716</span><span class="sd">        `Settings` objects generated from the configuration.</span>
<span class="linenos"> 717</span><span class="sd">    &quot;&quot;&quot;</span>
<span class="linenos"> 718</span>
<span class="linenos"> 719</span>    <span class="n">settings_config</span><span class="p">,</span> <span class="n">image_config</span><span class="p">,</span> <span class="n">plot_config</span> <span class="o">=</span> <span class="n">toml_to_dicts</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
<span class="linenos"> 720</span>
<span class="linenos"> 721</span>    <span class="k">try</span><span class="p">:</span>
<span class="linenos"> 722</span>        <span class="n">settings</span> <span class="o">=</span> <span class="n">Settings</span><span class="p">(</span><span class="o">**</span><span class="n">settings_config</span><span class="p">)</span>
<span class="linenos"> 723</span>
<span class="linenos"> 724</span>        <span class="k">if</span> <span class="n">return_settings</span><span class="p">:</span>
<span class="linenos"> 725</span>            <span class="k">return</span> <span class="n">settings</span>
<span class="linenos"> 726</span>
<span class="linenos"> 727</span>        <span class="n">image_settings</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get_image_settings</span><span class="p">(</span><span class="o">**</span><span class="n">image_config</span><span class="p">)</span>
<span class="linenos"> 728</span>        <span class="n">plot_settings</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get_plot_settings</span><span class="p">(</span><span class="o">**</span><span class="n">plot_config</span><span class="p">)</span>
<span class="linenos"> 729</span>
<span class="linenos"> 730</span>        <span class="k">return</span> <span class="n">image_settings</span><span class="p">,</span> <span class="n">plot_settings</span>
<span class="linenos"> 731</span>
<span class="linenos"> 732</span>    <span class="k">except</span> <span class="n">ValidationError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="linenos"> 733</span>        <span class="c1"># pydantic does a lot of wrapping around their errors...</span>
<span class="linenos"> 734</span>        <span class="n">original_error</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">errors</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<span class="linenos"> 735</span>        <span class="n">error_message</span> <span class="o">=</span> <span class="n">original_error</span><span class="p">[</span><span class="s2">&quot;msg&quot;</span><span class="p">]</span>  <span class="c1"># &quot;Value error, [original message]&quot;</span>
<span class="linenos"> 736</span>
<span class="linenos"> 737</span>        <span class="k">if</span> <span class="n">original_error</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;value_error&quot;</span><span class="p">:</span>  <span class="c1"># explicitly raised in a validator</span>
<span class="linenos"> 738</span>            <span class="n">skip_point</span> <span class="o">=</span> <span class="s2">&quot;error, &quot;</span>
<span class="linenos"> 739</span>            <span class="n">index</span> <span class="o">=</span> <span class="n">error_message</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">skip_point</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">skip_point</span><span class="p">)</span>
<span class="linenos"> 740</span>            <span class="n">new_message</span> <span class="o">=</span> <span class="n">error_message</span><span class="p">[</span><span class="n">index</span><span class="p">:]</span>
<span class="linenos"> 741</span>
<span class="linenos"> 742</span>        <span class="k">else</span><span class="p">:</span>  <span class="c1"># probaby a type coercion error listed in</span>
<span class="linenos"> 743</span>            <span class="c1"># https://docs.pydantic.dev/2.10/errors/validation_errors/</span>
<span class="linenos"> 744</span>            <span class="n">bad_dict_key</span> <span class="o">=</span> <span class="n">original_error</span><span class="p">[</span><span class="s2">&quot;loc&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="linenos"> 745</span>            <span class="n">bad_dict_value</span> <span class="o">=</span> <span class="n">original_error</span><span class="p">[</span><span class="s2">&quot;input&quot;</span><span class="p">]</span>
<span class="linenos"> 746</span>            <span class="n">new_message</span> <span class="o">=</span> <span class="p">(</span>
<span class="linenos"> 747</span>                <span class="sa">f</span><span class="s2">&quot;Error processing &#39;</span><span class="si">{</span><span class="n">bad_dict_value</span><span class="si">}</span><span class="s2">&#39; into </span><span class="si">{</span><span class="n">bad_dict_key</span><span class="si">}</span><span class="s2">. &quot;</span>
<span class="linenos"> 748</span>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">error_message</span><span class="si">}</span><span class="s2">.&quot;</span>
<span class="linenos"> 749</span>            <span class="p">)</span>
<span class="linenos"> 750</span>
<span class="linenos"> 751</span>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">new_message</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span></div>

<span class="linenos"> 752</span>
<span class="linenos"> 753</span>
<span class="linenos"> 754</span><span class="c1">## Helper Methods</span>
<span class="linenos"> 755</span>
<span class="linenos"> 756</span>
<div class="viewcode-block" id="toml_to_dicts">
<a class="viewcode-back" href="../../generated/skysim.settings.toml_to_dicts.html#skysim.settings.toml_to_dicts">[docs]</a>
<span class="linenos"> 757</span><span class="k">def</span><span class="w"> </span><span class="nf">toml_to_dicts</span><span class="p">(</span>
<span class="linenos"> 758</span>    <span class="n">filename</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
<span class="linenos"> 759</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="linenos"> 760</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Read the configuration file and combine it with the default configuration</span>
<span class="linenos"> 761</span><span class="sd">    to get dictionaries of values which can be used for the various `Settings` classes.</span>
<span class="linenos"> 762</span>
<span class="linenos"> 763</span><span class="sd">    Parameters</span>
<span class="linenos"> 764</span><span class="sd">    ----------</span>
<span class="linenos"> 765</span><span class="sd">    filename : pathlib.Path</span>
<span class="linenos"> 766</span><span class="sd">        Path the the toml config file.</span>
<span class="linenos"> 767</span>
<span class="linenos"> 768</span><span class="sd">    Returns</span>
<span class="linenos"> 769</span><span class="sd">    -------</span>
<span class="linenos"> 770</span><span class="sd">    tuple[ConfigMapping]</span>
<span class="linenos"> 771</span><span class="sd">        Dictionary for `Settings`, `ImageSettings`, and `PlotSettings`.</span>
<span class="linenos"> 772</span><span class="sd">    &quot;&quot;&quot;</span>
<span class="linenos"> 773</span>
<span class="linenos"> 774</span>    <span class="c1"># open the config file</span>
<span class="linenos"> 775</span>    <span class="k">with</span> <span class="n">filename</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">opened</span><span class="p">:</span>
<span class="linenos"> 776</span>        <span class="k">try</span><span class="p">:</span>
<span class="linenos"> 777</span>            <span class="n">toml_config</span> <span class="o">=</span> <span class="n">tomllib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">opened</span><span class="p">)</span>
<span class="linenos"> 778</span>        <span class="k">except</span> <span class="n">tomllib</span><span class="o">.</span><span class="n">TOMLDecodeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="linenos"> 779</span>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error reading config file. </span><span class="si">{</span><span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
<span class="linenos"> 780</span>
<span class="linenos"> 781</span>    <span class="n">check_mandatory_toml_keys</span><span class="p">(</span><span class="n">toml_config</span><span class="p">)</span>
<span class="linenos"> 782</span>
<span class="linenos"> 783</span>    <span class="k">with</span> <span class="n">DEFAULT_CONFIG_PATH</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">default</span><span class="p">:</span>
<span class="linenos"> 784</span>        <span class="n">default_config</span> <span class="o">=</span> <span class="n">tomllib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">default</span><span class="p">)</span>
<span class="linenos"> 785</span>
<span class="linenos"> 786</span>    <span class="n">load_or_default</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">toml_key</span><span class="p">,</span> <span class="n">default_key</span><span class="o">=</span><span class="kc">None</span><span class="p">:</span> <span class="n">get_config_option</span><span class="p">(</span>
<span class="linenos"> 787</span>        <span class="n">toml_config</span><span class="p">,</span> <span class="n">toml_key</span><span class="p">,</span> <span class="n">default_config</span><span class="p">,</span> <span class="n">default_key</span>
<span class="linenos"> 788</span>    <span class="p">)</span>
<span class="linenos"> 789</span>
<span class="linenos"> 790</span>    <span class="n">settings_config</span> <span class="o">=</span> <span class="p">{</span>
<span class="linenos"> 791</span>        <span class="c1"># Mandatory</span>
<span class="linenos"> 792</span>        <span class="s2">&quot;input_location&quot;</span><span class="p">:</span> <span class="n">toml_config</span><span class="p">[</span><span class="s2">&quot;observation&quot;</span><span class="p">][</span><span class="s2">&quot;location&quot;</span><span class="p">],</span>
<span class="linenos"> 793</span>        <span class="s2">&quot;field_of_view&quot;</span><span class="p">:</span> <span class="n">parse_angle_dict</span><span class="p">(</span><span class="n">toml_config</span><span class="p">[</span><span class="s2">&quot;observation&quot;</span><span class="p">][</span><span class="s2">&quot;viewing-radius&quot;</span><span class="p">]),</span>
<span class="linenos"> 794</span>        <span class="s2">&quot;altitude_angle&quot;</span><span class="p">:</span> <span class="n">parse_angle_dict</span><span class="p">(</span><span class="n">toml_config</span><span class="p">[</span><span class="s2">&quot;observation&quot;</span><span class="p">][</span><span class="s2">&quot;altitude&quot;</span><span class="p">]),</span>
<span class="linenos"> 795</span>        <span class="s2">&quot;azimuth_angle&quot;</span><span class="p">:</span> <span class="n">parse_angle_dict</span><span class="p">(</span><span class="n">toml_config</span><span class="p">[</span><span class="s2">&quot;observation&quot;</span><span class="p">][</span><span class="s2">&quot;azimuth&quot;</span><span class="p">]),</span>
<span class="linenos"> 796</span>        <span class="s2">&quot;start_date&quot;</span><span class="p">:</span> <span class="n">toml_config</span><span class="p">[</span><span class="s2">&quot;observation&quot;</span><span class="p">][</span><span class="s2">&quot;date&quot;</span><span class="p">],</span>
<span class="linenos"> 797</span>        <span class="s2">&quot;start_time&quot;</span><span class="p">:</span> <span class="n">toml_config</span><span class="p">[</span><span class="s2">&quot;observation&quot;</span><span class="p">][</span><span class="s2">&quot;time&quot;</span><span class="p">],</span>
<span class="linenos"> 798</span>        <span class="c1"># Optional</span>
<span class="linenos"> 799</span>        <span class="s2">&quot;image_pixels&quot;</span><span class="p">:</span> <span class="n">load_or_default</span><span class="p">(</span><span class="s2">&quot;image.pixels&quot;</span><span class="p">),</span>
<span class="linenos"> 800</span>        <span class="s2">&quot;duration&quot;</span><span class="p">:</span> <span class="n">time_to_timedelta</span><span class="p">(</span>
<span class="linenos"> 801</span>            <span class="n">load_or_default</span><span class="p">(</span><span class="s2">&quot;observation.duration&quot;</span><span class="p">)</span>  <span class="c1"># type: ignore[arg-type]</span>
<span class="linenos"> 802</span>        <span class="p">),</span>
<span class="linenos"> 803</span>        <span class="s2">&quot;snapshot_frequency&quot;</span><span class="p">:</span> <span class="n">time_to_timedelta</span><span class="p">(</span>
<span class="linenos"> 804</span>            <span class="n">load_or_default</span><span class="p">(</span><span class="s2">&quot;observation.interval&quot;</span><span class="p">)</span>  <span class="c1"># type: ignore[arg-type]</span>
<span class="linenos"> 805</span>        <span class="p">),</span>
<span class="linenos"> 806</span>    <span class="p">}</span>
<span class="linenos"> 807</span>
<span class="linenos"> 808</span>    <span class="n">image_config</span> <span class="o">=</span> <span class="p">{</span>
<span class="linenos"> 809</span>        <span class="n">k</span><span class="p">:</span> <span class="n">load_or_default</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;image.</span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">default_key</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;image.</span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos"> 810</span>        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="p">{</span>
<span class="linenos"> 811</span>            <span class="c1"># Optional</span>
<span class="linenos"> 812</span>            <span class="s2">&quot;object_colours&quot;</span><span class="p">:</span> <span class="s2">&quot;object-colours&quot;</span><span class="p">,</span>
<span class="linenos"> 813</span>            <span class="s2">&quot;colour_values&quot;</span><span class="p">:</span> <span class="s2">&quot;sky-colours&quot;</span><span class="p">,</span>
<span class="linenos"> 814</span>            <span class="s2">&quot;colour_time_indices&quot;</span><span class="p">:</span> <span class="s2">&quot;sky-colours-index-by-time&quot;</span><span class="p">,</span>
<span class="linenos"> 815</span>            <span class="s2">&quot;magnitude_values&quot;</span><span class="p">:</span> <span class="s2">&quot;maximum-magnitudes&quot;</span><span class="p">,</span>
<span class="linenos"> 816</span>            <span class="s2">&quot;magnitude_time_indices&quot;</span><span class="p">:</span> <span class="s2">&quot;maximum-magnitudes-index-by-time&quot;</span><span class="p">,</span>
<span class="linenos"> 817</span>        <span class="p">}</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
<span class="linenos"> 818</span>    <span class="p">}</span>
<span class="linenos"> 819</span>
<span class="linenos"> 820</span>    <span class="n">plot_config</span> <span class="o">=</span> <span class="p">{</span>
<span class="linenos"> 821</span>        <span class="c1"># Mandatory</span>
<span class="linenos"> 822</span>        <span class="s2">&quot;filename&quot;</span><span class="p">:</span> <span class="n">toml_config</span><span class="p">[</span><span class="s2">&quot;image&quot;</span><span class="p">][</span><span class="s2">&quot;filename&quot;</span><span class="p">],</span>
<span class="linenos"> 823</span>        <span class="c1"># Optional</span>
<span class="linenos"> 824</span>        <span class="s2">&quot;fps&quot;</span><span class="p">:</span> <span class="n">load_or_default</span><span class="p">(</span><span class="s2">&quot;image.fps&quot;</span><span class="p">),</span>
<span class="linenos"> 825</span>        <span class="s2">&quot;dpi&quot;</span><span class="p">:</span> <span class="n">load_or_default</span><span class="p">(</span><span class="s2">&quot;image.dpi&quot;</span><span class="p">),</span>
<span class="linenos"> 826</span>        <span class="s2">&quot;figure_size&quot;</span><span class="p">:</span> <span class="p">(</span>
<span class="linenos"> 827</span>            <span class="n">load_or_default</span><span class="p">(</span><span class="s2">&quot;image.width&quot;</span><span class="p">),</span>
<span class="linenos"> 828</span>            <span class="n">load_or_default</span><span class="p">(</span><span class="s2">&quot;image.height&quot;</span><span class="p">),</span>
<span class="linenos"> 829</span>        <span class="p">),</span>
<span class="linenos"> 830</span>    <span class="p">}</span>
<span class="linenos"> 831</span>
<span class="linenos"> 832</span>    <span class="k">return</span> <span class="n">settings_config</span><span class="p">,</span> <span class="n">image_config</span><span class="p">,</span> <span class="n">plot_config</span></div>

<span class="linenos"> 833</span>
<span class="linenos"> 834</span>
<div class="viewcode-block" id="split_nested_key">
<a class="viewcode-back" href="../../generated/skysim.settings.split_nested_key.html#skysim.settings.split_nested_key">[docs]</a>
<span class="linenos"> 835</span><span class="k">def</span><span class="w"> </span><span class="nf">split_nested_key</span><span class="p">(</span><span class="n">full_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="linenos"> 836</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert a string of the form &#39;a.b.c&#39; into a list of the form [&#39;a&#39;,&#39;b&#39;,&#39;c&#39;].</span>
<span class="linenos"> 837</span>
<span class="linenos"> 838</span><span class="sd">    Parameters</span>
<span class="linenos"> 839</span><span class="sd">    ----------</span>
<span class="linenos"> 840</span><span class="sd">    full_key : str</span>
<span class="linenos"> 841</span><span class="sd">        String of the form &#39;a.b.c&#39;.</span>
<span class="linenos"> 842</span>
<span class="linenos"> 843</span><span class="sd">    Returns</span>
<span class="linenos"> 844</span><span class="sd">    -------</span>
<span class="linenos"> 845</span><span class="sd">    list[str]</span>
<span class="linenos"> 846</span><span class="sd">        List generated from string.</span>
<span class="linenos"> 847</span><span class="sd">    &quot;&quot;&quot;</span>
<span class="linenos"> 848</span>    <span class="k">return</span> <span class="n">full_key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span></div>

<span class="linenos"> 849</span>
<span class="linenos"> 850</span>
<div class="viewcode-block" id="access_nested_dictionary">
<a class="viewcode-back" href="../../generated/skysim.settings.access_nested_dictionary.html#skysim.settings.access_nested_dictionary">[docs]</a>
<span class="linenos"> 851</span><span class="k">def</span><span class="w"> </span><span class="nf">access_nested_dictionary</span><span class="p">(</span>
<span class="linenos"> 852</span>    <span class="n">dictionary</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">keys</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
<span class="linenos"> 853</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ConfigValue</span><span class="p">:</span>
<span class="linenos"> 854</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Access a value from an arbitrarily nested dictionary via a list of keys.</span>
<span class="linenos"> 855</span>
<span class="linenos"> 856</span><span class="sd">    Parameters</span>
<span class="linenos"> 857</span><span class="sd">    ----------</span>
<span class="linenos"> 858</span><span class="sd">    dictionary : dict[str, typing.Any]</span>
<span class="linenos"> 859</span><span class="sd">        The top-level dictionary.</span>
<span class="linenos"> 860</span><span class="sd">    keys : list[str]</span>
<span class="linenos"> 861</span><span class="sd">        List of dictionary keys.</span>
<span class="linenos"> 862</span>
<span class="linenos"> 863</span><span class="sd">    Returns</span>
<span class="linenos"> 864</span><span class="sd">    -------</span>
<span class="linenos"> 865</span><span class="sd">    ConfigValue</span>
<span class="linenos"> 866</span><span class="sd">        The accessed value.</span>
<span class="linenos"> 867</span><span class="sd">    &quot;&quot;&quot;</span>
<span class="linenos"> 868</span>    <span class="n">subdictionary</span> <span class="o">=</span> <span class="n">dictionary</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="linenos"> 869</span>    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
<span class="linenos"> 870</span>        <span class="n">subdictionary</span> <span class="o">=</span> <span class="n">subdictionary</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
<span class="linenos"> 871</span>    <span class="k">return</span> <span class="n">subdictionary</span><span class="p">[</span><span class="n">keys</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span></div>

<span class="linenos"> 872</span>
<span class="linenos"> 873</span>
<div class="viewcode-block" id="check_key_exists">
<a class="viewcode-back" href="../../generated/skysim.settings.check_key_exists.html#skysim.settings.check_key_exists">[docs]</a>
<span class="linenos"> 874</span><span class="k">def</span><span class="w"> </span><span class="nf">check_key_exists</span><span class="p">(</span><span class="n">dictionary</span><span class="p">:</span> <span class="n">TOMLConfig</span><span class="p">,</span> <span class="n">full_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="linenos"> 875</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if a key exists within a nested dictionary.</span>
<span class="linenos"> 876</span>
<span class="linenos"> 877</span><span class="sd">    Parameters</span>
<span class="linenos"> 878</span><span class="sd">    ----------</span>
<span class="linenos"> 879</span><span class="sd">    dictionary : TOMLConfig</span>
<span class="linenos"> 880</span><span class="sd">        The top-level dictionary to check.</span>
<span class="linenos"> 881</span><span class="sd">    full_key : str</span>
<span class="linenos"> 882</span><span class="sd">        Potentially nested key.</span>
<span class="linenos"> 883</span>
<span class="linenos"> 884</span><span class="sd">    Returns</span>
<span class="linenos"> 885</span><span class="sd">    -------</span>
<span class="linenos"> 886</span><span class="sd">    bool</span>
<span class="linenos"> 887</span><span class="sd">        Whether or not the key exists.</span>
<span class="linenos"> 888</span><span class="sd">    &quot;&quot;&quot;</span>
<span class="linenos"> 889</span>    <span class="k">try</span><span class="p">:</span>
<span class="linenos"> 890</span>        <span class="n">value</span> <span class="o">=</span> <span class="n">access_nested_dictionary</span><span class="p">(</span><span class="n">dictionary</span><span class="p">,</span> <span class="n">split_nested_key</span><span class="p">(</span><span class="n">full_key</span><span class="p">))</span>
<span class="linenos"> 891</span>        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span>
<span class="linenos"> 892</span>        <span class="k">return</span> <span class="kc">True</span>
<span class="linenos"> 893</span>    <span class="k">except</span> <span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span> <span class="ne">AssertionError</span><span class="p">):</span>
<span class="linenos"> 894</span>        <span class="k">return</span> <span class="kc">False</span></div>

<span class="linenos"> 895</span>
<span class="linenos"> 896</span>
<div class="viewcode-block" id="check_mandatory_toml_keys">
<a class="viewcode-back" href="../../generated/skysim.settings.check_mandatory_toml_keys.html#skysim.settings.check_mandatory_toml_keys">[docs]</a>
<span class="linenos"> 897</span><span class="k">def</span><span class="w"> </span><span class="nf">check_mandatory_toml_keys</span><span class="p">(</span><span class="n">dictionary</span><span class="p">:</span> <span class="n">TOMLConfig</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos"> 898</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate the existence of the required keys in the TOML configuration.</span>
<span class="linenos"> 899</span>
<span class="linenos"> 900</span><span class="sd">    Parameters</span>
<span class="linenos"> 901</span><span class="sd">    ----------</span>
<span class="linenos"> 902</span><span class="sd">    dictionary : TOMLConfig</span>
<span class="linenos"> 903</span><span class="sd">        Loaded user configuration.</span>
<span class="linenos"> 904</span>
<span class="linenos"> 905</span><span class="sd">    Raises</span>
<span class="linenos"> 906</span><span class="sd">    ------</span>
<span class="linenos"> 907</span><span class="sd">    ValueError</span>
<span class="linenos"> 908</span><span class="sd">        Raised if:</span>
<span class="linenos"> 909</span><span class="sd">            - mandatory keys aren&#39;t present</span>
<span class="linenos"> 910</span><span class="sd">            - keys that require at least one of some group aren&#39;t present</span>
<span class="linenos"> 911</span><span class="sd">            - keys that are required in sets are not property provided</span>
<span class="linenos"> 912</span><span class="sd">    &quot;&quot;&quot;</span>
<span class="linenos"> 913</span>    <span class="n">mandatory_keys</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;observation.</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;location&quot;</span><span class="p">,</span> <span class="s2">&quot;date&quot;</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">)]</span> <span class="o">+</span> <span class="p">[</span>
<span class="linenos"> 914</span>        <span class="s2">&quot;image.filename&quot;</span>
<span class="linenos"> 915</span>    <span class="p">]</span>
<span class="linenos"> 916</span>
<span class="linenos"> 917</span>    <span class="c1"># Keys where at least one should be present (i.e., user can have any combination of</span>
<span class="linenos"> 918</span>    <span class="c1"># observation.altitude.degrees, observation.altitude.arcminutes, and</span>
<span class="linenos"> 919</span>    <span class="c1"># observation.altitude.arcseconds, but at least one of them must be included)</span>
<span class="linenos"> 920</span>    <span class="n">one_or_more_keys</span> <span class="o">=</span> <span class="p">[</span>
<span class="linenos"> 921</span>        <span class="p">[</span>
<span class="linenos"> 922</span>            <span class="sa">f</span><span class="s2">&quot;observation.</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">unit</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="linenos"> 923</span>            <span class="k">for</span> <span class="n">unit</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;degrees&quot;</span><span class="p">,</span> <span class="s2">&quot;arcminutes&quot;</span><span class="p">,</span> <span class="s2">&quot;arcseconds&quot;</span><span class="p">)</span>
<span class="linenos"> 924</span>        <span class="p">]</span>
<span class="linenos"> 925</span>        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;viewing-radius&quot;</span><span class="p">,</span> <span class="s2">&quot;altitude&quot;</span><span class="p">,</span> <span class="s2">&quot;azimuth&quot;</span><span class="p">)</span>
<span class="linenos"> 926</span>    <span class="p">]</span>
<span class="linenos"> 927</span>
<span class="linenos"> 928</span>    <span class="c1"># keys which should either be excluded entirely, or present only in complete sets</span>
<span class="linenos"> 929</span>    <span class="n">all_or_none_keys</span> <span class="o">=</span> <span class="p">[</span>
<span class="linenos"> 930</span>        <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;observation.</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;interval&quot;</span><span class="p">,</span> <span class="s2">&quot;duration&quot;</span><span class="p">)],</span>
<span class="linenos"> 931</span>        <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;image.</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;width&quot;</span><span class="p">,</span> <span class="s2">&quot;height&quot;</span><span class="p">)],</span>
<span class="linenos"> 932</span>    <span class="p">]</span>
<span class="linenos"> 933</span>    <span class="c1"># check that mandatory keys are provided</span>
<span class="linenos"> 934</span>    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">mandatory_keys</span><span class="p">:</span>
<span class="linenos"> 935</span>        <span class="k">if</span> <span class="ow">not</span> <span class="n">check_key_exists</span><span class="p">(</span><span class="n">dictionary</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
<span class="linenos"> 936</span>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Required element </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> was not found.&quot;</span><span class="p">)</span>
<span class="linenos"> 937</span>
<span class="linenos"> 938</span>    <span class="c1"># check that one-or-more keys are provided</span>
<span class="linenos"> 939</span>    <span class="k">for</span> <span class="n">keyset</span> <span class="ow">in</span> <span class="n">one_or_more_keys</span><span class="p">:</span>
<span class="linenos"> 940</span>        <span class="n">keys_exist</span> <span class="o">=</span> <span class="p">[</span><span class="n">check_key_exists</span><span class="p">(</span><span class="n">dictionary</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keyset</span><span class="p">]</span>
<span class="linenos"> 941</span>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">keys_exist</span><span class="p">):</span>
<span class="linenos"> 942</span>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<span class="linenos"> 943</span>                <span class="sa">f</span><span class="s2">&quot;One or more of </span><span class="si">{</span><span class="n">keyset</span><span class="si">}</span><span class="s2"> must be given, but none were found.&quot;</span>
<span class="linenos"> 944</span>            <span class="p">)</span>
<span class="linenos"> 945</span>
<span class="linenos"> 946</span>    <span class="c1"># all_or_none keys</span>
<span class="linenos"> 947</span>    <span class="k">for</span> <span class="n">keyset</span> <span class="ow">in</span> <span class="n">all_or_none_keys</span><span class="p">:</span>
<span class="linenos"> 948</span>        <span class="n">keys_exist</span> <span class="o">=</span> <span class="p">[</span><span class="n">check_key_exists</span><span class="p">(</span><span class="n">dictionary</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keyset</span><span class="p">]</span>
<span class="linenos"> 949</span>        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">keys_exist</span><span class="p">))</span> <span class="ow">and</span> <span class="nb">any</span><span class="p">(</span><span class="n">keys_exist</span><span class="p">):</span>
<span class="linenos"> 950</span>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<span class="linenos"> 951</span>                <span class="sa">f</span><span class="s2">&quot;Some but not all of the keys </span><span class="si">{</span><span class="n">keyset</span><span class="si">}</span><span class="s2"> were given. &quot;</span>
<span class="linenos"> 952</span>                <span class="s2">&quot;These keys must be given all together or not at all.&quot;</span>
<span class="linenos"> 953</span>            <span class="p">)</span>
<span class="linenos"> 954</span>
<span class="linenos"> 955</span>    <span class="k">return</span></div>

<span class="linenos"> 956</span>
<span class="linenos"> 957</span>
<div class="viewcode-block" id="parse_angle_dict">
<a class="viewcode-back" href="../../generated/skysim.settings.parse_angle_dict.html#skysim.settings.parse_angle_dict">[docs]</a>
<span class="linenos"> 958</span><span class="k">def</span><span class="w"> </span><span class="nf">parse_angle_dict</span><span class="p">(</span>
<span class="linenos"> 959</span>    <span class="n">dictionary</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span><span class="p">],</span>
<span class="linenos"> 960</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">[</span><span class="s2">&quot;angle&quot;</span><span class="p">]:</span>  <span class="c1"># type: ignore[type-arg, name-defined]</span>
<span class="linenos"> 961</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert a dictionary of the form {degrees:X, arcminutes:Y, arcseconds:Z}</span>
<span class="linenos"> 962</span><span class="sd">    to a single Quantity.</span>
<span class="linenos"> 963</span>
<span class="linenos"> 964</span><span class="sd">    Parameters</span>
<span class="linenos"> 965</span><span class="sd">    ----------</span>
<span class="linenos"> 966</span><span class="sd">    dictionary : dict[str , int | float]</span>
<span class="linenos"> 967</span><span class="sd">        Dictionary potentially containing angular information.</span>
<span class="linenos"> 968</span>
<span class="linenos"> 969</span><span class="sd">    Returns</span>
<span class="linenos"> 970</span><span class="sd">    -------</span>
<span class="linenos"> 971</span><span class="sd">    astropy.units.Quantity[angle]</span>
<span class="linenos"> 972</span><span class="sd">        Combined angle.</span>
<span class="linenos"> 973</span><span class="sd">    &quot;&quot;&quot;</span>
<span class="linenos"> 974</span>    <span class="n">total_angle</span> <span class="o">=</span> <span class="mi">0</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">deg</span>
<span class="linenos"> 975</span>
<span class="linenos"> 976</span>    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;degrees&quot;</span><span class="p">,</span> <span class="s2">&quot;arcminutes&quot;</span><span class="p">,</span> <span class="s2">&quot;arcseconds&quot;</span><span class="p">]:</span>
<span class="linenos"> 977</span>        <span class="n">value</span> <span class="o">=</span> <span class="n">dictionary</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="linenos"> 978</span>        <span class="k">try</span><span class="p">:</span>
<span class="linenos"> 979</span>            <span class="n">float_value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
<span class="linenos"> 980</span>        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="linenos"> 981</span>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<span class="linenos"> 982</span>                <span class="sa">f</span><span class="s2">&quot;Could not convert angular value </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2"> to a float.&quot;</span>
<span class="linenos"> 983</span>            <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
<span class="linenos"> 984</span>
<span class="linenos"> 985</span>        <span class="n">total_angle</span> <span class="o">+=</span> <span class="n">float_value</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">Unit</span><span class="p">(</span><span class="n">key</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="linenos"> 986</span>
<span class="linenos"> 987</span>    <span class="k">return</span> <span class="n">total_angle</span></div>

<span class="linenos"> 988</span>
<span class="linenos"> 989</span>
<div class="viewcode-block" id="time_to_timedelta">
<a class="viewcode-back" href="../../generated/skysim.settings.time_to_timedelta.html#skysim.settings.time_to_timedelta">[docs]</a>
<span class="linenos"> 990</span><span class="k">def</span><span class="w"> </span><span class="nf">time_to_timedelta</span><span class="p">(</span><span class="n">time_object</span><span class="p">:</span> <span class="n">time</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">timedelta</span><span class="p">:</span>
<span class="linenos"> 991</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Converts a `datetime.time` object to a `datetime.timedelta`.</span>
<span class="linenos"> 992</span>
<span class="linenos"> 993</span><span class="sd">    Parameters</span>
<span class="linenos"> 994</span><span class="sd">    ----------</span>
<span class="linenos"> 995</span><span class="sd">    time_object : datetime.time</span>
<span class="linenos"> 996</span><span class="sd">        Time as parsed by TOML.</span>
<span class="linenos"> 997</span>
<span class="linenos"> 998</span><span class="sd">    Returns</span>
<span class="linenos"> 999</span><span class="sd">    -------</span>
<span class="linenos">1000</span><span class="sd">    datetime.timedelta</span>
<span class="linenos">1001</span><span class="sd">        Timedelta corresponding to the time from midnight to the given time.</span>
<span class="linenos">1002</span><span class="sd">    &quot;&quot;&quot;</span>
<span class="linenos">1003</span>    <span class="n">components</span> <span class="o">=</span> <span class="p">{</span>
<span class="linenos">1004</span>        <span class="n">key</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">time_object</span><span class="p">,</span> <span class="n">key</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="linenos">1005</span>        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;hours&quot;</span><span class="p">,</span> <span class="s2">&quot;minutes&quot;</span><span class="p">,</span> <span class="s2">&quot;seconds&quot;</span><span class="p">,</span> <span class="s2">&quot;microseconds&quot;</span><span class="p">)</span>
<span class="linenos">1006</span>    <span class="p">}</span>
<span class="linenos">1007</span>    <span class="k">return</span> <span class="n">timedelta</span><span class="p">(</span><span class="o">**</span><span class="n">components</span><span class="p">)</span></div>

<span class="linenos">1008</span>
<span class="linenos">1009</span>
<div class="viewcode-block" id="get_config_option">
<a class="viewcode-back" href="../../generated/skysim.settings.get_config_option.html#skysim.settings.get_config_option">[docs]</a>
<span class="linenos">1010</span><span class="k">def</span><span class="w"> </span><span class="nf">get_config_option</span><span class="p">(</span>
<span class="linenos">1011</span>    <span class="n">toml_dictionary</span><span class="p">:</span> <span class="n">TOMLConfig</span><span class="p">,</span>
<span class="linenos">1012</span>    <span class="n">toml_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<span class="linenos">1013</span>    <span class="n">default_config</span><span class="p">:</span> <span class="n">TOMLConfig</span><span class="p">,</span>
<span class="linenos">1014</span>    <span class="n">default_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="linenos">1015</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ConfigValue</span><span class="p">:</span>
<span class="linenos">1016</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Access a config value from the TOML config provided, and if not present, search</span>
<span class="linenos">1017</span><span class="sd">    the provded default config.</span>
<span class="linenos">1018</span>
<span class="linenos">1019</span><span class="sd">    Parameters</span>
<span class="linenos">1020</span><span class="sd">    ----------</span>
<span class="linenos">1021</span><span class="sd">    toml_dictionary : TOMLConfig</span>
<span class="linenos">1022</span><span class="sd">        TOML configuration.</span>
<span class="linenos">1023</span><span class="sd">    toml_key : str</span>
<span class="linenos">1024</span><span class="sd">        Nested key to access the TOML dictionary with.</span>
<span class="linenos">1025</span><span class="sd">    default_config : TOMLConfig</span>
<span class="linenos">1026</span><span class="sd">        Default configuration dictionary.</span>
<span class="linenos">1027</span><span class="sd">    default_key : str | None, default None</span>
<span class="linenos">1028</span><span class="sd">        Alternative key to access the default dictionary with, if different from</span>
<span class="linenos">1029</span><span class="sd">        `toml_key`.</span>
<span class="linenos">1030</span>
<span class="linenos">1031</span><span class="sd">    Returns</span>
<span class="linenos">1032</span><span class="sd">    -------</span>
<span class="linenos">1033</span><span class="sd">    ConfigValue</span>
<span class="linenos">1034</span><span class="sd">        Value as located in one of the dictionaries.</span>
<span class="linenos">1035</span><span class="sd">    &quot;&quot;&quot;</span>
<span class="linenos">1036</span>    <span class="k">if</span> <span class="n">check_key_exists</span><span class="p">(</span><span class="n">toml_dictionary</span><span class="p">,</span> <span class="n">toml_key</span><span class="p">):</span>
<span class="linenos">1037</span>        <span class="k">return</span> <span class="n">access_nested_dictionary</span><span class="p">(</span><span class="n">toml_dictionary</span><span class="p">,</span> <span class="n">split_nested_key</span><span class="p">(</span><span class="n">toml_key</span><span class="p">))</span>
<span class="linenos">1038</span>    <span class="k">if</span> <span class="n">default_key</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos">1039</span>        <span class="n">default_key</span> <span class="o">=</span> <span class="n">toml_key</span>
<span class="linenos">1040</span>    <span class="k">return</span> <span class="n">access_nested_dictionary</span><span class="p">(</span><span class="n">default_config</span><span class="p">,</span> <span class="n">split_nested_key</span><span class="p">(</span><span class="n">default_key</span><span class="p">))</span></div>

<span class="linenos">1041</span>
<span class="linenos">1042</span>
<div class="viewcode-block" id="angle_to_dms">
<a class="viewcode-back" href="../../generated/skysim.settings.angle_to_dms.html#skysim.settings.angle_to_dms">[docs]</a>
<span class="linenos">1043</span><span class="k">def</span><span class="w"> </span><span class="nf">angle_to_dms</span><span class="p">(</span><span class="n">angle</span><span class="p">:</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">[</span><span class="s2">&quot;angle&quot;</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>  <span class="c1"># type: ignore[type-arg,name-defined]</span>
<span class="linenos">1044</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert a astropy angle to a pretty-printed string.</span>
<span class="linenos">1045</span>
<span class="linenos">1046</span><span class="sd">    Parameters</span>
<span class="linenos">1047</span><span class="sd">    ----------</span>
<span class="linenos">1048</span><span class="sd">    angle : astropy.units.Quantity[angle]</span>
<span class="linenos">1049</span><span class="sd">        The angle quantity to format.</span>
<span class="linenos">1050</span>
<span class="linenos">1051</span><span class="sd">    Returns</span>
<span class="linenos">1052</span><span class="sd">    -------</span>
<span class="linenos">1053</span><span class="sd">    str</span>
<span class="linenos">1054</span><span class="sd">        Latex-formatted string.</span>
<span class="linenos">1055</span><span class="sd">    &quot;&quot;&quot;</span>
<span class="linenos">1056</span>    <span class="n">arcseconds</span> <span class="o">=</span> <span class="n">angle</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">arcsec</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
<span class="linenos">1057</span>
<span class="linenos">1058</span>    <span class="n">has_seconds</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">arcseconds</span><span class="p">,</span> <span class="mi">60</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span>
<span class="linenos">1059</span>    <span class="n">has_minutes</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">arcseconds</span><span class="p">,</span> <span class="mi">3600</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span>
<span class="linenos">1060</span>
<span class="linenos">1061</span>    <span class="k">if</span> <span class="n">has_seconds</span><span class="p">:</span>
<span class="linenos">1062</span>        <span class="n">fields</span> <span class="o">=</span> <span class="mi">3</span>
<span class="linenos">1063</span>    <span class="k">elif</span> <span class="n">has_minutes</span><span class="p">:</span>
<span class="linenos">1064</span>        <span class="n">fields</span> <span class="o">=</span> <span class="mi">2</span>
<span class="linenos">1065</span>    <span class="k">else</span><span class="p">:</span>
<span class="linenos">1066</span>        <span class="n">fields</span> <span class="o">=</span> <span class="mi">1</span>
<span class="linenos">1067</span>
<span class="linenos">1068</span>    <span class="n">ap_angle</span> <span class="o">=</span> <span class="n">Angle</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
<span class="linenos">1069</span>    <span class="k">return</span> <span class="n">ap_angle</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">fields</span><span class="o">=</span><span class="n">fields</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;latex&quot;</span><span class="p">)</span></div>

</pre></div>

                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright  2025, Tai Withers.
      <br/>
    
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.2.3.
    <br/>
  </p>
</div>
      
        <div class="footer-item">
<p class="theme-version">
  <!-- # L10n: Setting the PST URL as an argument as this does not need to be localized -->
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.1.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>